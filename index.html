<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ProPath ‚Äî Football Career Simulator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#080c10; --surface:#0f1419; --surface2:#161d26; --surface3:#1e2833;
  --accent:#00e5a0; --accent2:#ff6b35; --gold:#f5c842; --text:#e8edf2;
  --text-dim:#7a8a99; --text-muted:#3d4f5e; --border:#1e2d3d;
  --border-bright:#2a3f52; --red:#ff4757; --blue:#4a9eff; --purple:#a78bfa;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
.pitch-bg{position:fixed;inset:0;z-index:0;overflow:hidden;
  background:radial-gradient(ellipse 120% 80% at 50% 120%,#00200f 0%,transparent 60%),
             radial-gradient(ellipse 60% 40% at 80% -10%,#0a1a2a 0%,transparent 50%);}
.pitch-bg::before{content:'';position:absolute;inset:0;
  background-image:repeating-linear-gradient(90deg,transparent,transparent 59px,rgba(0,229,160,.03) 59px,rgba(0,229,160,.03) 60px),
  repeating-linear-gradient(0deg,transparent,transparent 59px,rgba(0,229,160,.03) 59px,rgba(0,229,160,.03) 60px);
  animation:gridDrift 24s linear infinite;}
@keyframes gridDrift{to{background-position:60px 60px;}}
#app{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:24px 16px;}
.screen{display:none;width:100%;max-width:1100px;animation:screenIn .4s cubic-bezier(.22,1,.36,1) both;}
.screen.active{display:block;}
@keyframes screenIn{from{opacity:0;transform:translateY(20px) scale(.98);}to{opacity:1;transform:none;}}

/* Typography */
.logo{text-align:center;margin-bottom:32px;}
.logo-wordmark{font-family:'Bebas Neue',sans-serif;font-size:clamp(52px,10vw,90px);letter-spacing:8px;line-height:1;
  background:linear-gradient(135deg,#fff 30%,var(--accent) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 36px rgba(0,229,160,.2));}
.logo-sub{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--text-dim);margin-top:4px;}
h2{font-family:'Bebas Neue',sans-serif;font-size:clamp(24px,5vw,38px);letter-spacing:2px;margin-bottom:6px;}
h3{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:1px;margin-bottom:10px;}
.section-label{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--accent);margin-bottom:10px;}
.lead{color:var(--text-dim);font-size:13px;line-height:1.7;margin-bottom:20px;}

/* Cards */
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:.4;}
.card-sm{padding:16px;border-radius:12px;}

/* Buttons */
.btn{display:inline-flex;align-items:center;gap:7px;padding:12px 24px;border-radius:10px;border:none;
  font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;}
.btn-primary{background:var(--accent);color:#040d08;}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,229,160,.3);}
.btn-primary:disabled{opacity:.4;transform:none;cursor:not-allowed;box-shadow:none;}
.btn-secondary{background:transparent;color:var(--text-dim);border:1.5px solid var(--border-bright);}
.btn-secondary:hover{border-color:var(--text-dim);color:var(--text);}
.btn-ghost{background:transparent;color:var(--text-muted);border:1px solid var(--border);font-size:11px;padding:7px 12px;}
.btn-ghost:hover{color:var(--text-dim);border-color:var(--border-bright);}
.btn-danger{background:rgba(255,71,87,.15);color:var(--red);border:1.5px solid rgba(255,71,87,.4);}
.btn-danger:hover{background:rgba(255,71,87,.25);}
.btn-gold{background:rgba(245,200,66,.15);color:var(--gold);border:1.5px solid rgba(245,200,66,.4);}
.btn-gold:hover{background:rgba(245,200,66,.25);}
.btn-row{display:flex;justify-content:space-between;align-items:center;margin-top:24px;gap:10px;flex-wrap:wrap;}

/* Forms */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;}
@media(max-width:560px){.form-grid{grid-template-columns:1fr;}}
.form-group{display:flex;flex-direction:column;gap:6px;}
.form-group.full{grid-column:1/-1;}
label,.field-label{display:block;font-size:10px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);margin-bottom:8px;}
input[type="text"],input[type="number"],select,textarea{
  background:var(--surface2);border:1px solid var(--border-bright);border-radius:9px;
  padding:11px 14px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text);
  outline:none;transition:border-color .2s,box-shadow .2s;width:100%;appearance:none;-webkit-appearance:none;}
input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,229,160,.1);}
select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%237a8a99' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px;cursor:pointer;}
select option{background:#1a2535;}
.field-error{font-size:11px;color:var(--red);display:none;}
.field-error.show{display:block;margin-top:3px;}

/* Steps */
.steps-bar{display:flex;align-items:center;justify-content:center;gap:0;margin-bottom:24px;}
.step{display:flex;align-items:center;gap:7px;font-size:10px;font-weight:600;color:var(--text-muted);font-family:'DM Mono',monospace;letter-spacing:1px;text-transform:uppercase;}
.step.active{color:var(--accent);}
.step.done{color:var(--text-dim);}
.step-dot{width:24px;height:24px;border-radius:50%;border:2px solid currentColor;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0;}
.step.active .step-dot{background:var(--accent);border-color:var(--accent);color:#040d08;box-shadow:0 0 14px rgba(0,229,160,.4);}
.step.done .step-dot{background:var(--surface3);}
.step-line{flex:1;height:2px;background:var(--border);max-width:36px;min-width:12px;}

/* Age slider */
.age-slider-wrap{display:flex;align-items:center;gap:18px;}
.age-display{font-family:'Bebas Neue',sans-serif;font-size:50px;line-height:1;color:var(--accent);min-width:64px;text-align:center;text-shadow:0 0 24px rgba(0,229,160,.35);}
.age-info{flex:1;}
.age-desc-text{font-size:11px;color:var(--text-dim);margin-top:5px;font-style:italic;}
input[type="range"]{width:100%;appearance:none;-webkit-appearance:none;height:4px;background:var(--surface3);border-radius:99px;outline:none;cursor:pointer;}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);border:3px solid var(--bg);box-shadow:0 0 10px rgba(0,229,160,.45);transition:transform .15s;}
input[type="range"]::-webkit-slider-thumb:hover{transform:scale(1.2);}
.range-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--text-muted);margin-top:5px;font-family:'DM Mono',monospace;}

/* Position / nation / trait grids */
.position-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:7px;margin-bottom:6px;}
.pos-btn{background:var(--surface2);border:1.5px solid var(--border);border-radius:9px;padding:10px 8px;cursor:pointer;text-align:center;transition:all .2s;user-select:none;}
.pos-btn:hover{border-color:var(--accent);background:rgba(0,229,160,.06);}
.pos-btn.selected{border-color:var(--accent);background:rgba(0,229,160,.1);box-shadow:0 0 0 1px var(--accent);}
.pos-acronym{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:1px;color:var(--accent);display:block;margin-bottom:2px;}
.pos-name{font-size:9px;color:var(--text-dim);}
.nations-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:6px;max-height:240px;overflow-y:auto;padding-right:4px;margin-bottom:6px;}
.nation-btn{background:var(--surface2);border:1.5px solid var(--border);border-radius:9px;padding:8px 6px;cursor:pointer;text-align:center;transition:all .2s;user-select:none;font-size:10px;color:var(--text-dim);display:flex;flex-direction:column;align-items:center;gap:2px;}
.nation-btn:hover{border-color:var(--blue);color:var(--text);}
.nation-btn.selected{border-color:var(--blue);background:rgba(74,158,255,.1);color:var(--text);box-shadow:0 0 0 1px var(--blue);}
.nation-flag{font-size:20px;}
.trait-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(145px,1fr));gap:8px;margin-bottom:6px;}
.trait-card{background:var(--surface2);border:1.5px solid var(--border);border-radius:10px;padding:12px;cursor:pointer;transition:all .2s;user-select:none;}
.trait-card:hover{border-color:var(--accent2);}
.trait-card.selected{border-color:var(--accent2);background:rgba(255,107,53,.1);box-shadow:0 0 0 1px var(--accent2);}
.trait-icon{font-size:22px;margin-bottom:6px;display:block;}
.trait-name{font-size:11px;font-weight:600;margin-bottom:2px;}
.trait-desc{font-size:10px;color:var(--text-dim);line-height:1.4;}

/* Player card */
.player-card-preview{background:linear-gradient(145deg,#1a2535,#0f1a27);border:1px solid var(--border-bright);border-radius:14px;padding:20px;display:flex;align-items:center;gap:20px;margin-bottom:20px;box-shadow:0 12px 40px rgba(0,0,0,.3);}
.card-avatar{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--surface3),var(--surface2));border:3px solid var(--border-bright);display:flex;align-items:center;justify-content:center;font-size:30px;flex-shrink:0;}
.card-info{flex:1;min-width:0;}
.card-name{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px;line-height:1;margin-bottom:7px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card-meta{display:flex;gap:6px;flex-wrap:wrap;}
.meta-pill{background:var(--surface3);border:1px solid var(--border);border-radius:4px;padding:2px 8px;font-size:10px;font-weight:600;}
.meta-pill.pos{color:var(--accent);border-color:rgba(0,229,160,.3);}
.meta-pill.age{color:var(--gold);border-color:rgba(245,200,66,.3);}
.meta-pill.nat{color:var(--blue);border-color:rgba(74,158,255,.3);}
.card-rating-box{width:62px;height:72px;background:linear-gradient(145deg,var(--accent2),#c94420);border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 5px 16px rgba(255,107,53,.25);}
.rating-num{font-family:'Bebas Neue',sans-serif;font-size:30px;line-height:1;color:#fff;}
.rating-label{font-size:8px;letter-spacing:2px;color:rgba(255,255,255,.7);font-family:'DM Mono',monospace;}

/* Stat bars */
.stat-bars{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;}
.stat-row{display:flex;align-items:center;gap:9px;}
.stat-name{font-size:9px;color:var(--text-dim);min-width:68px;font-family:'DM Mono',monospace;}
.stat-bar-track{flex:1;height:5px;background:var(--surface3);border-radius:99px;overflow:hidden;}
.stat-bar-fill{height:100%;border-radius:99px;transition:width .8s cubic-bezier(.22,1,.36,1);}
.stat-val{font-size:11px;font-weight:600;min-width:24px;text-align:right;}

/* Attrs */
.attr-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}
.attr-box{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:9px;text-align:center;}
.attr-v{font-family:'Bebas Neue',sans-serif;font-size:24px;line-height:1;}
.attr-l{font-size:8px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;}
.good{color:var(--accent);} .mid{color:var(--gold);} .low{color:var(--red);}

/* Dashboard */
.dash-topbar{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
.dash-greeting{font-family:'Bebas Neue',sans-serif;font-size:clamp(18px,3.5vw,30px);letter-spacing:2px;}
.dash-subtitle{color:var(--text-dim);font-size:11px;margin-top:3px;}
.topbar-right{display:flex;align-items:center;gap:6px;flex-shrink:0;flex-wrap:wrap;}
.season-badge{background:var(--surface2);border:1px solid var(--border-bright);border-radius:7px;padding:7px 12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text-dim);}

/* Tab navigation */
.tab-nav{display:flex;gap:0;background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:4px;margin-bottom:20px;flex-wrap:wrap;gap:2px;}
.tab-btn{flex:1;min-width:80px;padding:8px 12px;border:none;border-radius:9px;background:transparent;color:var(--text-dim);font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;text-align:center;white-space:nowrap;}
.tab-btn.active{background:var(--surface);color:var(--text);box-shadow:0 2px 8px rgba(0,0,0,.3);}
.tab-btn:hover:not(.active){color:var(--text);}
.tab-pane{display:none;}
.tab-pane.active{display:block;}

/* Progress bar */
.season-prog{margin-bottom:16px;}
.prog-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace;margin-bottom:5px;}
.prog-track{height:5px;background:var(--surface3);border-radius:99px;overflow:hidden;}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),#00b37e);border-radius:99px;transition:width .5s ease;}

/* Stat pills */
.stats-pill-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
.stat-pill{background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:9px 14px;display:flex;flex-direction:column;align-items:center;gap:1px;min-width:64px;}
.sp-icon{font-size:14px;}
.sp-val{font-family:'Bebas Neue',sans-serif;font-size:20px;line-height:1;color:var(--text);}
.sp-label{font-size:8px;color:var(--text-muted);letter-spacing:1px;text-transform:uppercase;font-family:'DM Mono',monospace;}

/* Match sim */
.match-card{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:12px;}
.match-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;}
.match-teams{display:flex;align-items:center;gap:12px;flex:1;}
.team-name{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:1px;flex:1;}
.team-name.away{text-align:right;}
.match-score{font-family:'Bebas Neue',sans-serif;font-size:32px;letter-spacing:2px;padding:0 14px;color:var(--text);}
.match-result-badge{padding:4px 12px;border-radius:6px;font-size:11px;font-weight:700;border:1px solid;}
.result-W{background:rgba(0,229,160,.12);color:var(--accent);border-color:rgba(0,229,160,.3);}
.result-D{background:rgba(245,200,66,.12);color:var(--gold);border-color:rgba(245,200,66,.3);}
.result-L{background:rgba(255,71,87,.12);color:var(--red);border-color:rgba(255,71,87,.3);}
.match-events-list{display:flex;flex-direction:column;gap:5px;}
.match-ev{font-size:11px;color:var(--text-dim);display:flex;align-items:flex-start;gap:7px;padding:4px 0;}
.match-ev-icon{flex-shrink:0;}
.not-selected-banner{background:rgba(255,71,87,.08);border:1px solid rgba(255,71,87,.2);border-radius:10px;padding:14px 16px;text-align:center;font-size:13px;color:var(--red);margin-bottom:12px;}
.starting-banner{background:rgba(0,229,160,.08);border:1px solid rgba(0,229,160,.2);border-radius:10px;padding:14px 16px;text-align:center;font-size:13px;color:var(--accent);margin-bottom:12px;}
.sub-banner{background:rgba(245,200,66,.08);border:1px solid rgba(245,200,66,.2);border-radius:10px;padding:14px 16px;text-align:center;font-size:13px;color:var(--gold);margin-bottom:12px;}

/* League table */
.league-table{width:100%;border-collapse:collapse;font-size:12px;}
.league-table th{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);}
.league-table td{padding:8px 10px;border-bottom:1px solid var(--border);color:var(--text-dim);}
.league-table tr.my-team td{color:var(--text);background:rgba(0,229,160,.04);}
.league-table tr.my-team .team-col{color:var(--accent);font-weight:600;}
.league-table tr:last-child td{border-bottom:none;}
.pos-col{font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--text-muted);width:30px;}
.pos-col.top{color:var(--accent);}
.pos-col.mid{color:var(--gold);}
.pos-col.rel{color:var(--red);}
.form-dots{display:flex;gap:3px;}
.form-dot{width:8px;height:8px;border-radius:50%;}

/* Training shop */
.training-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;}
.train-item{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:8px;}
.train-stat-name{font-size:12px;font-weight:600;}
.train-current{font-family:'Bebas Neue',sans-serif;font-size:28px;line-height:1;}
.train-cost{font-size:11px;color:var(--gold);}
.train-cost.cant-afford{color:var(--red);}
.salary-display{display:flex;align-items:center;gap:8px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;margin-bottom:16px;}
.salary-amount{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--gold);}
.salary-label{font-size:11px;color:var(--text-dim);}

/* Competitions */
.comp-list{display:flex;flex-direction:column;gap:8px;}
.comp-row{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;display:flex;align-items:center;gap:12px;}
.comp-badge{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.comp-info{flex:1;}
.comp-name{font-size:13px;font-weight:600;margin-bottom:2px;}
.comp-status{font-size:11px;color:var(--text-dim);}
.comp-result{font-size:12px;font-weight:600;}

/* Free agent */
.free-agent-banner{background:linear-gradient(135deg,rgba(255,71,87,.1),rgba(255,107,53,.05));border:1px solid rgba(255,71,87,.3);border-radius:12px;padding:20px;text-align:center;margin-bottom:16px;}
.club-offers{display:flex;flex-direction:column;gap:8px;}
.club-offer{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;}
.offer-info{flex:1;}
.offer-club{font-size:14px;font-weight:600;}
.offer-detail{font-size:11px;color:var(--text-dim);margin-top:2px;}

/* Hall of fame */
.hof-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;}
.hof-card{background:linear-gradient(145deg,#1a2535,#0f1a27);border:1px solid var(--border-bright);border-radius:14px;padding:20px;}
.hof-name{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;margin-bottom:4px;}
.hof-meta{font-size:11px;color:var(--text-dim);margin-bottom:12px;}
.hof-stats{display:grid;grid-template-columns:1fr 1fr;gap:6px;}
.hof-stat{background:var(--surface3);border-radius:7px;padding:8px;text-align:center;}
.hof-stat-v{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--accent);}
.hof-stat-l{font-size:9px;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px;}
.hof-empty{text-align:center;padding:48px;color:var(--text-muted);font-size:13px;}
.hof-trophy{font-size:48px;margin-bottom:12px;}

/* Timeline */
.career-timeline{list-style:none;display:flex;flex-direction:column;gap:0;max-height:360px;overflow-y:auto;}
.career-timeline::-webkit-scrollbar{width:3px;}
.career-timeline::-webkit-scrollbar-thumb{background:var(--border-bright);border-radius:99px;}
.timeline-event{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-bottom:1px solid var(--border);}
.timeline-event:last-child{border-bottom:none;}
.te-icon{width:28px;height:28px;border-radius:50%;background:var(--surface2);border:1px solid var(--border-bright);display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0;}
.te-content{flex:1;}
.te-title{font-size:12px;font-weight:600;margin-bottom:1px;}
.te-meta{font-size:10px;color:var(--text-dim);}

/* Day event items */
.day-events{display:flex;flex-direction:column;gap:6px;}
.day-ev{background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:10px 12px;display:flex;align-items:flex-start;gap:10px;animation:evIn .25s ease both;}
@keyframes evIn{from{opacity:0;transform:translateX(-6px);}}
.day-ev.type-match{border-left:3px solid var(--blue);}
.day-ev.type-training{border-left:3px solid var(--surface3);}
.day-ev.type-growth{border-left:3px solid var(--accent);}
.day-ev.type-milestone{border-left:3px solid var(--gold);}
.day-ev.type-injury{border-left:3px solid var(--red);}
.day-ev.type-transfer{border-left:3px solid var(--purple);}
.dv-icon{font-size:16px;flex-shrink:0;margin-top:1px;}
.dv-body{flex:1;}
.dv-title{font-size:12px;font-weight:600;margin-bottom:2px;}
.dv-detail{font-size:10px;color:var(--text-dim);line-height:1.5;}
.dv-tags{display:flex;align-items:center;gap:4px;flex-wrap:wrap;margin-top:3px;}
.tag{padding:2px 6px;border-radius:4px;font-size:9px;font-weight:700;border:1px solid;}
.tag-result{background:rgba(74,158,255,.1);color:var(--blue);border-color:rgba(74,158,255,.3);}
.tag-goal{background:rgba(0,229,160,.1);color:var(--accent);border-color:rgba(0,229,160,.3);}
.tag-motm{background:rgba(245,200,66,.12);color:var(--gold);border-color:rgba(245,200,66,.3);}
.tag-red{background:rgba(255,71,87,.12);color:var(--red);border-color:rgba(255,71,87,.3);}
.tag-rat{font-size:10px;font-weight:700;color:var(--text-dim);background:transparent;border-color:transparent;}

/* Log history */
.log-history{display:flex;flex-direction:column;gap:4px;max-height:280px;overflow-y:auto;}
.log-history::-webkit-scrollbar{width:3px;}
.log-history::-webkit-scrollbar-thumb{background:var(--border-bright);border-radius:99px;}
.log-row{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:7px;background:var(--surface2);font-size:11px;border:1px solid var(--border);cursor:pointer;}
.log-row:hover{border-color:var(--border-bright);}
.lr-date{color:var(--text-muted);min-width:120px;font-family:'DM Mono',monospace;font-size:9px;flex-shrink:0;}
.lr-desc{flex:1;color:var(--text-dim);}

/* Modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:200;display:flex;align-items:center;justify-content:center;animation:fadeIn .25s ease;padding:16px;}
@keyframes fadeIn{from{opacity:0;}}
.modal-box{background:var(--surface);border:1px solid var(--border-bright);border-radius:18px;padding:32px;max-width:520px;width:100%;position:relative;animation:slideUp .35s cubic-bezier(.22,1,.36,1);max-height:90vh;overflow-y:auto;}
@keyframes slideUp{from{opacity:0;transform:translateY(28px);}}
.modal-title{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;margin-bottom:14px;}
.modal-stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0;}
.modal-stat{background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:11px 14px;}
.ms-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);font-family:'DM Mono',monospace;}
.ms-val{font-size:20px;font-weight:700;color:var(--text);}

/* Splash */
.start-hero{text-align:center;padding:40px 28px;}
.pitch-ring{width:136px;height:136px;margin:0 auto 24px;border-radius:50%;border:3px solid var(--border-bright);position:relative;display:flex;align-items:center;justify-content:center;animation:ringPulse 3s ease-in-out infinite;}
@keyframes ringPulse{0%,100%{box-shadow:0 0 0 0 rgba(0,229,160,.2);}50%{box-shadow:0 0 0 18px rgba(0,229,160,0);}}
.pitch-ring::before{content:'';position:absolute;inset:9px;border-radius:50%;border:2px solid rgba(0,229,160,.18);}
.ball-icon{font-size:58px;}

/* Summary */
.summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
@media(max-width:560px){.summary-grid{grid-template-columns:1fr;}}
.summary-item{background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:12px 14px;}
.s-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);font-family:'DM Mono',monospace;margin-bottom:3px;}
.s-value{font-size:15px;font-weight:600;}

/* Toast */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(70px);background:var(--surface);border:1px solid var(--accent);border-radius:9px;padding:10px 20px;font-size:12px;color:var(--text);box-shadow:0 6px 24px rgba(0,0,0,.4);z-index:999;transition:transform .3s cubic-bezier(.22,1,.36,1);white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}

/* Misc */
.chip{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:5px;font-size:10px;font-weight:600;border:1px solid;}
.chip-green{background:rgba(0,229,160,.1);color:var(--accent);border-color:rgba(0,229,160,.3);}
.chip-red{background:rgba(255,71,87,.1);color:var(--red);border-color:rgba(255,71,87,.3);}
.chip-gold{background:rgba(245,200,66,.1);color:var(--gold);border-color:rgba(245,200,66,.3);}
.chip-blue{background:rgba(74,158,255,.1);color:var(--blue);border-color:rgba(74,158,255,.3);}
.empty-state{text-align:center;padding:28px;color:var(--text-muted);font-size:12px;border:1px dashed var(--border);border-radius:10px;}
::-webkit-scrollbar{width:5px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border-bright);border-radius:99px;}
.nations-grid::-webkit-scrollbar,.career-timeline::-webkit-scrollbar,.log-history::-webkit-scrollbar{width:3px;}
</style>
</head>
<body>
<div class="pitch-bg"></div>
<div id="app">

<!-- SCREEN 0: SPLASH -->
<div class="screen active" id="screen-0">
  <div class="logo"><div class="logo-wordmark">ProPath</div><div class="logo-sub">Football Career Simulator v2</div></div>
  <div class="card" style="max-width:540px;margin:0 auto;">
    <div class="start-hero">
      <div class="pitch-ring"><span class="ball-icon">‚öΩ</span></div>
      <h2>Your Journey Begins</h2>
      <p class="lead" style="margin-bottom:0;">From youth academy to legend. Every day matters. Every match shapes your career.</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:28px;flex-wrap:wrap;">
        <button class="btn btn-primary" style="font-size:15px;padding:14px 36px;" onclick="App.goTo(1)">‚öΩ New Career</button>
        <button class="btn btn-gold" style="font-size:15px;padding:14px 24px;" onclick="App.loadGame()">üíæ Load Save</button>
      </div>
      <div style="margin-top:16px;"><button class="btn btn-ghost" onclick="App.goTo(6)">üèÜ Hall of Fame</button></div>
    </div>
  </div>
</div>

<!-- SCREEN 1-4: CHARACTER CREATION -->
<div class="screen" id="screen-1">
  <div class="steps-bar" id="steps-bar"></div>
  <div class="card">
    <div id="creation-content"></div>
  </div>
</div>

<!-- SCREEN 5: MAIN DASHBOARD -->
<div class="screen" id="screen-5">
  <div class="dash-topbar">
    <div>
      <div class="dash-greeting" id="dashGreeting"></div>
      <div class="dash-subtitle" id="dashSubtitle"></div>
    </div>
    <div class="topbar-right">
      <div class="season-badge" id="seasonBadge"></div>
      <div class="salary-chip" id="salaryChip" style="background:var(--surface2);border:1px solid rgba(245,200,66,.3);border-radius:7px;padding:7px 12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);"></div>
      <button class="btn btn-ghost" onclick="App.saveGame()" title="Save">üíæ</button>
      <button class="btn btn-ghost" onclick="App.confirmNewCareer()" title="New Career">‚Ü©</button>
    </div>
  </div>

  <div id="dashPlayerCard" style="margin-bottom:16px;"></div>
  <div id="seasonProgress" style="margin-bottom:12px;"></div>
  <div class="stats-pill-row" id="seasonStatPills"></div>

  <!-- Free agent banner (hidden by default) -->
  <div id="freeAgentBanner" style="display:none;" class="free-agent-banner">
    <div style="font-size:28px;margin-bottom:8px;">üîì</div>
    <div style="font-size:16px;font-weight:700;color:var(--red);margin-bottom:4px;">Free Agent</div>
    <div style="font-size:12px;color:var(--text-dim);margin-bottom:12px;">You're currently without a club. Sign for any team ‚Äî no window needed.</div>
    <button class="btn btn-primary" onclick="App.showFreeAgentOffers()">View Club Offers ‚Üí</button>
  </div>

  <!-- Tab nav -->
  <div class="tab-nav" id="tabNav">
    <button class="tab-btn active" onclick="App.switchTab('overview')">üìä Overview</button>
    <button class="tab-btn" onclick="App.switchTab('matches')">‚öΩ Matches</button>
    <button class="tab-btn" onclick="App.switchTab('league')">üèÜ League</button>
    <button class="tab-btn" onclick="App.switchTab('cups')">ü•á Cups</button>
    <button class="tab-btn" onclick="App.switchTab('training')">üí™ Training</button>
    <button class="tab-btn" onclick="App.switchTab('career')">üìã Career</button>
  </div>

  <!-- OVERVIEW TAB -->
  <div class="tab-pane active" id="tab-overview">
    <div style="display:grid;grid-template-columns:1fr 300px;gap:14px;align-items:start;">
      <div>
        <!-- Day advance panel -->
        <div class="card" style="margin-bottom:14px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;">
            <div>
              <div class="section-label">Today</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;" id="currentDayLabel">‚Äî</div>
            </div>
            <div style="display:flex;gap:7px;flex-wrap:wrap;">
              <button class="btn btn-primary" id="advanceBtn" onclick="App.advanceDay()">‚ñ∂ Next Day</button>
              <button class="btn btn-secondary" id="skipWeekBtn" onclick="App.skipWeek()">‚è© Skip Week</button>
              <button class="btn btn-ghost" id="skipMonthBtn" onclick="App.skipMonth()">‚è≠ Skip Month</button>
            </div>
          </div>
          <div id="lastDayEvents" class="day-events">
            <div class="empty-state">‚öΩ<br><br>Click <strong>Next Day</strong> to begin your career</div>
          </div>
        </div>
        <!-- Recent log -->
        <div class="card">
          <div class="section-label">Recent Activity</div>
          <div class="log-history" id="recentLog"></div>
        </div>
      </div>
      <div>
        <!-- Attributes -->
        <div class="card" style="margin-bottom:14px;">
          <div class="section-label">Attributes</div>
          <div class="attr-grid" id="dashAttrs"></div>
          <div style="margin-top:12px;"><div class="section-label">Form</div><div id="formDots"></div></div>
          <div style="margin-top:12px;"><div class="section-label">Potential</div><div style="font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--gold);" id="potDisplay"></div></div>
        </div>
        <!-- Career log -->
        <div class="card">
          <div class="section-label">Career Timeline</div>
          <ul class="career-timeline" id="careerLog"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- MATCHES TAB -->
  <div class="tab-pane" id="tab-matches">
    <div class="card" style="margin-bottom:14px;">
      <div class="section-label">Upcoming Fixtures</div>
      <div id="upcomingFixtures"></div>
    </div>
    <div class="card">
      <div class="section-label">Match History</div>
      <div id="matchHistory"></div>
    </div>
  </div>

  <!-- LEAGUE TAB -->
  <div class="tab-pane" id="tab-league">
    <div class="card" style="margin-bottom:14px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <div><div class="section-label">League Table</div><h3 id="leagueName">‚Äî</h3></div>
        <div id="leagueQualInfo" style="font-size:11px;color:var(--text-dim);text-align:right;max-width:200px;"></div>
      </div>
      <div style="overflow-x:auto;"><table class="league-table" id="leagueTable"><thead></thead><tbody></tbody></table></div>
    </div>
  </div>

  <!-- CUPS TAB -->
  <div class="tab-pane" id="tab-cups">
    <div class="section-label">Cup Competitions</div>
    <div class="comp-list" id="cupsList"></div>
  </div>

  <!-- TRAINING TAB -->
  <div class="tab-pane" id="tab-training">
    <div class="salary-display" id="walletDisplay">
      <span style="font-size:20px;">üí∞</span>
      <div><div class="salary-amount" id="walletAmount">¬£0</div><div class="salary-label">Available Balance</div></div>
      <div style="margin-left:auto;font-size:11px;color:var(--text-dim);" id="weeklySalaryLabel"></div>
    </div>
    <p class="lead">Invest your wages to improve specific attributes. The better you already are, the more it costs.</p>
    <div class="training-grid" id="trainingGrid"></div>
  </div>

  <!-- CAREER TAB -->
  <div class="tab-pane" id="tab-career">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
      <div class="card">
        <div class="section-label">Career Stats</div>
        <div id="careerStatsGrid"></div>
      </div>
      <div class="card">
        <div class="section-label">Contract & Club</div>
        <div id="contractInfo"></div>
      </div>
    </div>
    <div class="card" style="margin-top:14px;">
      <div class="section-label">Career Achievements</div>
      <div id="achievementsList"></div>
    </div>
  </div>
</div>

<!-- SCREEN 6: HALL OF FAME -->
<div class="screen" id="screen-6">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:10px;">
    <div><div class="logo-wordmark" style="font-size:48px;">Hall of Fame</div><div class="logo-sub">Legendary Careers</div></div>
    <button class="btn btn-secondary" onclick="App.goTo(0)">‚Üê Back</button>
  </div>
  <div id="hofContent"></div>
</div>

</div><!-- #app -->

<!-- MODALS -->
<div id="modalLayer" style="display:none;"></div>
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const NATIONS=[{name:'England',flag:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø'},{name:'Spain',flag:'üá™üá∏'},{name:'France',flag:'üá´üá∑'},{name:'Germany',flag:'üá©üá™'},{name:'Italy',flag:'üáÆüáπ'},{name:'Brazil',flag:'üáßüá∑'},{name:'Argentina',flag:'üá¶üá∑'},{name:'Portugal',flag:'üáµüáπ'},{name:'Netherlands',flag:'üá≥üá±'},{name:'Belgium',flag:'üáßüá™'},{name:'Uruguay',flag:'üá∫üáæ'},{name:'Colombia',flag:'üá®üá¥'},{name:'Mexico',flag:'üá≤üáΩ'},{name:'USA',flag:'üá∫üá∏'},{name:'Japan',flag:'üáØüáµ'},{name:'South Korea',flag:'üá∞üá∑'},{name:'Senegal',flag:'üá∏üá≥'},{name:'Morocco',flag:'üá≤üá¶'},{name:'Nigeria',flag:'üá≥üá¨'},{name:'Ghana',flag:'üá¨üá≠'},{name:'Egypt',flag:'üá™üá¨'},{name:'Ivory Coast',flag:'üá®üáÆ'},{name:'Cameroon',flag:'üá®üá≤'},{name:'Croatia',flag:'üá≠üá∑'},{name:'Denmark',flag:'üá©üá∞'},{name:'Switzerland',flag:'üá®üá≠'},{name:'Poland',flag:'üáµüá±'},{name:'Serbia',flag:'üá∑üá∏'},{name:'Scotland',flag:'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø'},{name:'Wales',flag:'üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø'},{name:'Republic of Ireland',flag:'üáÆüá™'},{name:'Sweden',flag:'üá∏üá™'},{name:'Norway',flag:'üá≥üá¥'},{name:'Australia',flag:'üá¶üá∫'},{name:'Canada',flag:'üá®üá¶'},{name:'Greece',flag:'üá¨üá∑'},{name:'Turkey',flag:'üáπüá∑'},{name:'Ecuador',flag:'üá™üá®'},{name:'Chile',flag:'üá®üá±'}];

const POSITIONS=[{acronym:'GK',name:'Goalkeeper'},{acronym:'CB',name:'Centre Back'},{acronym:'LB',name:'Left Back'},{acronym:'RB',name:'Right Back'},{acronym:'CDM',name:'Def. Midfielder'},{acronym:'CM',name:'Centre Mid'},{acronym:'CAM',name:'Att. Midfielder'},{acronym:'LW',name:'Left Winger'},{acronym:'RW',name:'Right Winger'},{acronym:'CF',name:'Centre Forward'},{acronym:'ST',name:'Striker'}];

const TRAITS=[
  {icon:'‚ö°',name:'Pace Monster',desc:'Blistering speed & acceleration.',boosts:{pace:6,dribbling:2}},
  {icon:'üéØ',name:'Clinical Finisher',desc:'Elite composure in the box.',boosts:{shooting:7,physical:2}},
  {icon:'üß†',name:'Playmaker',desc:'Vision & passing to unlock defences.',boosts:{passing:7,dribbling:2}},
  {icon:'üí™',name:'Physical Beast',desc:'Dominant in duels, iron stamina.',boosts:{physical:7,defending:2}},
  {icon:'üõ°Ô∏è',name:'Rock Solid',desc:'Perfect positioning & reading.',boosts:{defending:8,physical:2}},
  {icon:'ü™Ñ',name:'Dribble Wizard',desc:'Silky ball control, impossible to stop.',boosts:{dribbling:8,pace:2}},
  {icon:'ü¶Ö',name:'Aerial Threat',desc:'Dominant in the air.',boosts:{physical:5,shooting:3}},
  {icon:'üîÆ',name:'Long Shot Specialist',desc:'Thunderbolt shots from range.',boosts:{shooting:5,passing:3}},
];

const POS_BASE={
  GK:{pace:42,shooting:14,passing:46,dribbling:34,defending:16,physical:54},
  CB:{pace:48,shooting:28,passing:50,dribbling:36,defending:60,physical:58},
  LB:{pace:56,shooting:30,passing:54,dribbling:50,defending:52,physical:50},
  RB:{pace:56,shooting:30,passing:54,dribbling:50,defending:52,physical:50},
  CDM:{pace:50,shooting:38,passing:56,dribbling:46,defending:58,physical:56},
  CM:{pace:52,shooting:46,passing:58,dribbling:52,defending:42,physical:52},
  CAM:{pace:54,shooting:54,passing:60,dribbling:58,defending:30,physical:46},
  LW:{pace:62,shooting:50,passing:52,dribbling:62,defending:26,physical:44},
  RW:{pace:62,shooting:50,passing:52,dribbling:62,defending:26,physical:44},
  CF:{pace:56,shooting:60,passing:52,dribbling:54,defending:24,physical:52},
  ST:{pace:54,shooting:62,passing:46,dribbling:50,defending:22,physical:56},
};

const POS_WEIGHTS={
  GK:{pace:.4,shooting:.05,passing:.7,dribbling:.4,defending:1.8,physical:1.2},
  CB:{pace:.7,shooting:.3,passing:.9,dribbling:.5,defending:1.9,physical:1.4},
  LB:{pace:1.4,shooting:.5,passing:1.1,dribbling:.9,defending:1.2,physical:.9},
  RB:{pace:1.4,shooting:.5,passing:1.1,dribbling:.9,defending:1.2,physical:.9},
  CDM:{pace:.7,shooting:.5,passing:1.1,dribbling:.7,defending:1.8,physical:1.4},
  CM:{pace:.8,shooting:.9,passing:1.5,dribbling:1.1,defending:.8,physical:1.0},
  CAM:{pace:.9,shooting:1.4,passing:1.5,dribbling:1.4,defending:.3,physical:.7},
  LW:{pace:1.8,shooting:1.1,passing:.8,dribbling:1.7,defending:.3,physical:.6},
  RW:{pace:1.8,shooting:1.1,passing:.8,dribbling:1.7,defending:.3,physical:.6},
  CF:{pace:1.2,shooting:1.9,passing:.7,dribbling:1.1,defending:.2,physical:1.1},
  ST:{pace:1.1,shooting:2.0,passing:.6,dribbling:1.0,defending:.2,physical:1.3},
};

// Season calendar ‚Äî now daily
// Season: July 1 ‚Üí June 30 (365 days), matches only on certain day patterns
const MONTHS=['July','August','September','October','November','December','January','February','March','April','May','June'];
// Match months (0=Jul..11=Jun). Summer = May,Jun,Jul (off-season training)
const MATCH_MONTHS=[1,2,3,4,5,6,7,8,9]; // Aug-Apr = competitive season

const AGE_DESC={15:'Youth academy prodigy ‚Äî raw talent, enormous ceiling.',16:'Youth academy sensation.',17:'Breaking into the first team ‚Äî hungry and determined.',18:'First professional contract signed.',19:'Up-and-coming talent with bags of potential.',20:'Young professional with something to prove.',21:'Promising career gaining momentum.',22:'Entering prime development years.',23:'Honing your craft, ready for a bigger club.',24:'Consistent performer, attracting attention.',25:'Peak years approaching ‚Äî prime time.',26:'In the heart of your prime.',27:'Prime season ‚Äî performing at your best.',28:'Experienced professional, a dressing room leader.',29:'Battle-hardened veteran with wisdom to share.',30:'Final chapter ‚Äî what legacy will you leave?'};

// LEAGUES
const LEAGUES=[
  {id:'L5',name:'National Youth League',tier:5,prestige:1,salary:800,size:12,promoted:2,relegated:2,cupQual:'none'},
  {id:'L4',name:'League Two',tier:4,prestige:2,salary:2500,size:14,promoted:3,relegated:3,cupQual:'fa_cup'},
  {id:'L3',name:'League One',tier:3,prestige:3,salary:6000,size:14,promoted:2,relegated:3,cupQual:'fa_cup,league_cup'},
  {id:'L2',name:'Championship',tier:2,prestige:4,salary:18000,size:16,promoted:3,relegated:3,cupQual:'fa_cup,league_cup'},
  {id:'L1',name:'Premier League',tier:1,prestige:5,salary:75000,size:20,promoted:0,relegated:3,cupQual:'fa_cup,league_cup,euro_cup'},
];

const CLUBS={
  5:['Stevenage Youth','Harrogate Juniors','Fleetwood Academy','Morecambe Reserves','Aldershot Town','Barnet Youth'],
  4:['Grimsby Town','Crawley Town','Swindon Town','Bradford City','Barrow AFC','Doncaster Rovers','AFC Wimbledon'],
  3:['Portsmouth','Charlton Athletic','Lincoln City','Shrewsbury Town','Peterborough Utd','Oxford United'],
  2:['Southampton','Leeds United','Burnley','Sheffield United','Middlesbrough','Coventry City','Preston NE','Stoke City'],
  1:['Arsenal','Chelsea','Liverpool','Manchester City','Manchester United','Tottenham','Newcastle','Aston Villa','West Ham','Brighton'],
};

// Cups (fictional-ish names to avoid copyright)
const CUPS=[
  {id:'fa_cup',name:'The Knockout Cup',icon:'üèÜ',desc:'The oldest cup competition in football',minTier:4,rounds:['R3','R4','R5','QF','SF','Final']},
  {id:'league_cup',name:'League Shield',icon:'ü•á',desc:'Domestic cup for league clubs',minTier:3,rounds:['R2','R3','QF','SF','Final']},
  {id:'euro_cup',name:'Europa Elite',icon:'‚≠ê',desc:'Continental prestige ‚Äî top league clubs only',minTier:1,rounds:['Group','R16','QF','SF','Final']},
];

const GOAL_FLAVOUR=['rifled into the top corner','calmly slotted past the keeper','powerful header from a corner','stunning volley','tap-in from close range','curled effort into the far post','chip over the keeper','instinctive backheel finish'];
const ASSIST_FLAVOUR=['threaded the perfect through ball','whipped in a delicious cross','dummied and played in the runner','perfectly weighted lofted ball'];
const MOTM_FLAVOUR=['dominated from first whistle','was simply unplayable tonight','dictated the tempo throughout','put in a masterclass performance','had the crowd on their feet all night'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const E = {
  rand:(a,b)=>Math.floor(Math.random()*(b-a+1))+a,
  pick:arr=>arr[Math.floor(Math.random()*arr.length)],
  clamp:(v,lo,hi)=>Math.max(lo,Math.min(hi,v)),

  calcOVR(attrs,pos){
    const w=POS_WEIGHTS[pos]||POS_WEIGHTS.CM;
    let s=0,ws=0;
    Object.keys(w).forEach(k=>{s+=(attrs[k]||50)*w[k];ws+=w[k];});
    return E.clamp(Math.round(s/ws),30,99);
  },

  buildAttrs(pos,age,traitIdx){
    const base=POS_BASE[pos]||POS_BASE.CM;
    const trait=TRAITS[traitIdx];
    const dev=Math.max(0,age-15);
    const ageFactor=dev<=8?dev*1.4:8*1.4+(dev-8)*0.8;
    const attrs={};
    ['pace','shooting','passing','dribbling','defending','physical'].forEach(k=>{
      let v=base[k]+Math.round(ageFactor*.7)+E.rand(-3,3);
      if(trait?.boosts?.[k])v+=trait.boosts[k];
      attrs[k]=E.clamp(v,28,90);
    });
    return attrs;
  },

  calcPotential(ovr,age){
    const bonus=Math.max(0,27-age)*1.8+E.rand(3,10);
    return E.clamp(Math.round(ovr+bonus),ovr+2,95);
  },

  trainCost(currentVal){
    // Exponential cost curve: cheap at low values, very expensive at high
    if(currentVal<40) return 500;
    if(currentVal<50) return 1500;
    if(currentVal<60) return 4000;
    if(currentVal<65) return 8000;
    if(currentVal<70) return 15000;
    if(currentVal<75) return 28000;
    if(currentVal<80) return 55000;
    if(currentVal<85) return 110000;
    return 220000;
  },

  // Generate a league of AI clubs for the player's tier
  generateLeague(tier,myClubName){
    const size=LEAGUES.find(l=>l.tier===tier)?.size||14;
    const clubs=[...CLUBS[tier]].filter(c=>c!==myClubName);
    // Shuffle and pick
    clubs.sort(()=>Math.random()-.5);
    const teams=[{name:myClubName,isPlayer:true,ovr:E.rand(62,72),pts:0,played:0,won:0,drawn:0,lost:0,gf:0,ga:0,gd:0,form:[]}];
    for(let i=0;i<size-1;i++){
      const name=clubs[i%clubs.length]+(i>=clubs.length?` ${i-clubs.length+2}`:'');
      teams.push({name,isPlayer:false,ovr:E.rand(55,82),pts:0,played:0,won:0,drawn:0,lost:0,gf:0,ga:0,gd:0,form:[]});
    }
    return teams;
  },

  simulateAIMatch(home,away){
    // Returns {hg,ag}
    const diff=(home.ovr-away.ovr)/10;
    const homeAdv=0.15;
    const hStrength=0.5+diff*.12+homeAdv;
    const hg=Math.random()<hStrength+.1?E.rand(0,3):E.rand(0,2);
    const ag=Math.random()<(1-hStrength)+.1?E.rand(0,3):E.rand(0,2);
    return{hg,ag};
  },

  selectPlayer(playerOVR,teamAvgOVR){
    // Manager picks player if OVR is within acceptable range
    const diff=playerOVR-teamAvgOVR;
    if(diff>=2)return'start';       // clearly good enough
    if(diff>=-3)return Math.random()<.65?'start':'bench';
    if(diff>=-8)return Math.random()<.3?'bench':'out';
    return'out';
  },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let G={};  // global game state

function initGame(draft){
  const attrs=E.buildAttrs(draft.position,draft.age,draft.trait);
  const ovr=E.calcOVR(attrs,draft.position);
  const pot=E.calcPotential(ovr,draft.age);
  const club=assignClub(draft.age,ovr);
  const league=LEAGUES.find(l=>l.tier===club.tier)||LEAGUES[0];
  const startYear=new Date().getFullYear();

  G={
    player:{
      firstName:draft.firstName,lastName:draft.lastName,nickname:draft.nickname||'',
      age:draft.age,nation:draft.nation,position:draft.position,foot:draft.foot,trait:draft.trait,
      attrs,overall:ovr,potential:pot,
    },
    club:{name:club.clubName,tier:club.tier,leagueId:league.id,contractYears:3,isFreeAgent:false},
    wallet:club.salary*4,  // start with 4 weeks wages
    weeklySalary:club.salary,
    season:{number:1,startYear,dayOfSeason:0,totalDays:365,finished:false,offSeason:false},
    seasonStats:{goals:0,assists:0,apps:0,motm:0,yellows:0,reds:0,wins:0,draws:0,losses:0,ratingSum:0,ratingCount:0,avgRating:0,cleanSheets:0},
    careerStats:{goals:0,assists:0,apps:0,motm:0,seasons:0,trophies:0,reds:0,bestOVR:ovr,highestLeague:club.tier},
    achievements:new Set(),
    careerLog:[],
    dayLog:[],         // all days this season
    matchHistory:[],   // all matches played
    upcomingFixtures:[], // scheduled fixture days
    league:{
      name:league.name,
      tier:club.tier,
      teams:E.generateLeague(club.tier,club.clubName),
      matchdays:[],    // scheduled matchday indices
      nextMatchday:0,
    },
    cups:{fa_cup:null,league_cup:null,euro_cup:null},
    form:[],
    injuryDaysLeft:0,
    freeAgentOffers:[],
  };

  // Schedule league matchdays throughout the season (days 32-305 = Aug-Apr)
  scheduleLeague();
  scheduleCups();

  G.careerLog.push({icon:'‚öΩ',title:'Career Begins',detail:`${draft.firstName} ${draft.lastName} joins ${club.clubName}`,date:getDayLabel(0)});
}

function assignClub(age,ovr){
  let tier=5;
  if(ovr>=72)tier=1; else if(ovr>=68)tier=2; else if(ovr>=64)tier=3; else if(ovr>=60)tier=4;
  if(age<=17)tier=Math.max(tier,5); // youth always start lower
  const league=LEAGUES.find(l=>l.tier===tier)||LEAGUES[0];
  return{...league,clubName:E.pick(CLUBS[tier])};
}

function scheduleLeague(){
  // Spread ~38 matchdays across days 32-305 (Aug-Apr = ~274 days)
  const start=32,end=305;
  const numMatches=(G.league.teams.length-1)*2; // home and away
  const spread=Math.floor((end-start)/numMatches);
  G.league.matchdays=[];
  for(let i=0;i<numMatches;i++){
    G.league.matchdays.push(start+i*spread+E.rand(0,spread-1));
  }
  G.league.matchdays.sort((a,b)=>a-b);
}

function scheduleCups(){
  // FA Cup: days 120-280, League Cup: 90-260, Euro: 60-290
  G.cups={};
  const tier=G.club.tier;
  CUPS.forEach(cup=>{
    if(tier>cup.minTier)return; // not qualified
    G.cups[cup.id]={...cup,stage:0,eliminated:false,winner:false,matchDays:[]};
    // Schedule cup match days
    const cupDays={fa_cup:[128,156,184,220,258,285],league_cup:[95,116,145,185,240,268],euro_cup:[62,90,118,178,220,258]};
    G.cups[cup.id].matchDays=(cupDays[cup.id]||[]).map(d=>d+E.rand(-3,3));
  });
}

function getDayLabel(dayOfSeason){
  // Day 0 = July 1
  const monthIdx=Math.floor(dayOfSeason/30.4)%12;
  const dayOfMonth=(dayOfSeason%Math.round(30.4))+1;
  return `${MONTHS[monthIdx]} ${dayOfMonth}`;
}

function getSeasonPhase(day){
  const m=Math.floor(day/30.4)%12;
  if(m>=10||m<=0)return'off-season'; // May, Jun, Jul
  return'season';
}

function isMatchDay(day){
  return G.league.matchdays.includes(day);
}

function isCupDay(day){
  return Object.values(G.cups||{}).some(c=>!c.eliminated&&c.matchDays&&c.matchDays.includes(day));
}

function getDueCups(day){
  return Object.entries(G.cups||{}).filter(([id,c])=>!c.eliminated&&c.matchDays&&c.matchDays.includes(day));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DAY SIMULATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function simulateDay(){
  const day=G.season.dayOfSeason;
  const phase=getSeasonPhase(day);
  const events=[];

  // Injury recovery
  if(G.injuryDaysLeft>0){
    G.injuryDaysLeft--;
    events.push({type:'injury',icon:'ü§ï',title:'Recovery Day',detail:`${G.injuryDaysLeft} day${G.injuryDaysLeft!==1?'s':''} until full fitness.`});
    return events;
  }

  // Salary (weekly, every 7 days)
  if(day>0&&day%7===0&&!G.club.isFreeAgent){
    G.wallet+=G.weeklySalary;
    events.push({type:'salary',icon:'üí∞',title:`Weekly Wages`,detail:`+¬£${G.weeklySalary.toLocaleString()} received.`});
  }

  const isLeagueMatch=isMatchDay(day)&&!G.club.isFreeAgent;
  const dueCups=getDueCups(day);

  if(isLeagueMatch){
    const matchEv=simulateLeagueMatch();
    events.push(...matchEv);
  } else if(dueCups.length>0){
    dueCups.forEach(([cupId,cup])=>{
      const cupEv=simulateCupMatch(cupId,cup);
      events.push(...cupEv);
    });
  } else if(phase==='season'){
    // Regular training day
    if(Math.random()<0.08){
      // Random small match (friendly / reserve)
      events.push({type:'training',icon:'üéΩ',title:'Reserve Match',detail:'Played for the reserve team ‚Äî good minutes in the legs.'});
    } else {
      events.push(simulateTraining());
    }
    // Occasional attribute growth
    if(Math.random()<0.04){
      const g=simulateGrowth();
      if(g)events.push(g);
    }
  } else {
    // Off-season
    events.push(simulateOffseasonTraining());
    if(Math.random()<0.02){
      const g=simulateGrowth();
      if(g)events.push(g);
    }
  }

  // Random injury chance
  if(events.some(e=>e.type==='match')&&Math.random()<0.04&&G.injuryDaysLeft===0){
    const days=E.rand(3,21);
    G.injuryDaysLeft=days;
    events.push({type:'injury',icon:'ü§ï',title:`Injury ‚Äî ${days} days out`,detail:E.pick(['Hamstring tweak','Ankle knock','Muscle strain','Bruised ribs'])});
    G.careerLog.push({icon:'ü§ï',title:'Injury',detail:`Out for ${days} days`,date:getDayLabel(day)});
  }

  // Check milestones
  checkMilestones(events,day);

  return events;
}

function simulateLeagueMatch(){
  const day=G.season.dayOfSeason;
  const mi=G.league.nextMatchday||0;
  const homeTeam=mi%2===0?G.club.name:'Opponent';
  G.league.nextMatchday=(mi+1)%G.league.matchdays.length;

  // Pick opponent (cycle through teams)
  const opponents=G.league.teams.filter(t=>!t.isPlayer);
  const opp=opponents[mi%(opponents.length)];

  // Determine selection
  const myOVR=G.player.overall;
  const teamOVR=E.rand(60,78);
  const selection=E.selectPlayer(myOVR,teamOVR);

  const events=[];

  if(selection==='out'){
    events.push({type:'match',icon:'ü™ë',title:`Not Selected ‚Äî ${G.club.name} vs ${opp.name}`,detail:`The manager left you out of the squad entirely. Keep working in training.`,selection:'out'});
    // AI simulates the match
    const res=E.simulateAIMatch({ovr:teamOVR},{ovr:opp.ovr});
    updateLeagueTable(G.club.name,opp.name,res.hg,res.ag,true);
  } else {
    const res=runMatchSim(G.club.name,opp.name,opp.ovr,teamOVR,selection);
    events.push(res);
  }

  return events;
}

function simulateCupMatch(cupId,cup){
  const cup_def=CUPS.find(c=>c.id===cupId)||{name:'Cup',icon:'üèÜ',rounds:['R1']};
  const stageLabel=cup.rounds?cup.rounds[cup.stage]||'Final':cup_def.rounds[cup.stage]||'Final';
  const oppTier=E.clamp(G.club.tier+E.rand(-1,1),1,5);
  const oppOVR=E.rand(58,80);
  const oppName=E.pick(CLUBS[oppTier]||CLUBS[3]);
  const selection=E.selectPlayer(G.player.overall,oppOVR);
  const events=[];

  if(selection==='out'){
    events.push({type:'match',icon:'ü™ë',title:`${cup_def.name} ${stageLabel} ‚Äî Not Selected`,detail:`Missed out on the cup match vs ${oppName}.`,selection:'out'});
    // Random result
    const win=Math.random()<0.5;
    if(win)cup.stage++;
    else {cup.eliminated=true;G.cups[cupId]=cup;}
  } else {
    const res=runMatchSim(`${G.club.name} (Cup)`,oppName,oppOVR,G.player.overall,selection,true);
    res.title=`${cup_def.icon} ${cup_def.name} ${stageLabel}: ${res.title}`;
    res.isCup=true;
    events.push(res);
    const win=res.result==='W';
    if(win){
      cup.stage++;
      if(cup.stage>=cup_def.rounds.length){
        // Won the cup!
        cup.winner=true;cup.eliminated=true;
        G.careerStats.trophies++;
        G.careerLog.push({icon:'üèÜ',title:`${cup_def.name} Winner!`,detail:`Lifted the trophy ‚Äî a career-defining moment`,date:getDayLabel(G.season.dayOfSeason)});
        events.push({type:'milestone',icon:'üèÜ',title:`üéâ ${cup_def.name} Won!`,detail:'The team lifts the trophy! An incredible achievement.'});
        showToast(`üèÜ ${cup_def.name} Winner!`);
      }
    } else {
      cup.eliminated=true;
    }
    G.cups[cupId]=cup;
  }
  return events;
}

function runMatchSim(homeName,awayName,oppOVR,teamOVR,selection,isCup){
  const isAtt=['ST','CF','LW','RW','CAM'].includes(G.player.position);
  const isMid=['CM','CDM'].includes(G.player.position);

  const homeAdv=homeName===G.club.name?0.1:0;
  const skillDiff=(teamOVR-oppOVR)/100;
  const hgBase=Math.random()<0.6+skillDiff+homeAdv?E.rand(0,3):E.rand(0,1);
  const agBase=Math.random()<0.5-skillDiff?E.rand(0,3):E.rand(0,1);
  let hg=hgBase,ag=agBase;

  let myGoals=0,myAssists=0,myRating=E.rand(58,80);
  const isStart=selection==='start';
  const isSub=selection==='bench';

  if(isStart||isSub){
    if(isAtt&&hg>0){
      myGoals=Math.min(E.rand(0,2),hg);
      myAssists=hg>myGoals&&Math.random()<.35?1:0;
    }else if(isMid&&hg>0){
      myAssists=Math.random()<.4?1:0;
      myGoals=Math.random()<.12?1:0;
    }
    if(isSub){myGoals=Math.min(myGoals,1);myRating=E.clamp(myRating-5,50,85);}
  }

  const motm=isStart&&Math.random()<.18;
  const yellow=isStart&&Math.random()<.09;
  const red=!yellow&&isStart&&Math.random()<.02;
  if(motm)myRating=E.clamp(myRating+E.rand(7,15),70,99);
  if(red)myRating=E.clamp(myRating-20,30,70);

  const result=hg>ag?'W':hg<ag?'L':'D';

  // Update stats
  if(isStart||isSub){
    G.seasonStats.apps++;G.careerStats.apps++;
    G.seasonStats.goals+=myGoals;G.careerStats.goals+=myGoals;
    G.seasonStats.assists+=myAssists;G.careerStats.assists+=myAssists;
    if(motm){G.seasonStats.motm++;G.careerStats.motm++;}
    if(yellow)G.seasonStats.yellows++;
    if(red){G.seasonStats.reds++;G.careerStats.reds++;}
    if(result==='W')G.seasonStats.wins++;
    else if(result==='D')G.seasonStats.draws++;
    else G.seasonStats.losses++;
    if(ag===0&&['GK','CB','LB','RB','CDM'].includes(G.player.position))G.seasonStats.cleanSheets++;
    G.seasonStats.ratingSum+=myRating;
    G.seasonStats.ratingCount++;
    G.seasonStats.avgRating=Math.round(G.seasonStats.ratingSum/G.seasonStats.ratingCount);
    G.form.push(myRating);
    if(G.form.length>5)G.form.shift();
  }

  // League table update
  if(!isCup)updateLeagueTable(G.club.name,awayName,hg,ag,homeName===G.club.name);

  // Build detail text
  let detail='';
  const selLabel=isStart?'Started':isSub?'Came off bench':'Not in squad';
  detail+=`${selLabel}. `;
  if(myGoals>0)detail+=`${myGoals} goal${myGoals>1?'s':''} ‚Äî "${E.pick(GOAL_FLAVOUR)}". `;
  if(myAssists>0)detail+=`${myAssists} assist ‚Äî "${E.pick(ASSIST_FLAVOUR)}". `;
  if(motm)detail+=`üåü Man of the Match ‚Äî "${E.pick(MOTM_FLAVOUR)}". `;
  if(yellow)detail+=`üü® Booked. `;
  if(red)detail+=`üü• Red card. `;
  if(!myGoals&&!myAssists&&!motm&&isStart)detail+=`Solid ${myRating>=68?'performance':'display'}.`;

  // Store in match history
  const matchRecord={date:getDayLabel(G.season.dayOfSeason),home:homeName,away:awayName,hg,ag,result,rating:Math.round(myRating),goals:myGoals,assists:myAssists,motm,isCup:!!isCup,selection};
  G.matchHistory.push(matchRecord);

  return{
    type:'match',icon:'‚öΩ',
    title:`${homeName} ${hg}‚Äì${ag} ${awayName}`,
    detail:detail.trim(),
    result,hg,ag,myGoals,myAssists,myRating:Math.round(myRating),motm,yellow,red,selection,
  };
}

function updateLeagueTable(myClub,oppName,hg,ag,myClubIsHome){
  const home=G.league.teams.find(t=>t.name===(myClubIsHome?myClub:oppName));
  const away=G.league.teams.find(t=>t.name===(myClubIsHome?oppName:myClub));
  if(home){
    home.played++;home.gf+=hg;home.ga+=ag;home.gd=home.gf-home.ga;
    if(hg>ag){home.won++;home.pts+=3;home.form.push('W');}
    else if(hg===ag){home.drawn++;home.pts+=1;home.form.push('D');}
    else{home.lost++;home.form.push('L');}
    if(home.form.length>5)home.form.shift();
  }
  if(away){
    away.played++;away.gf+=ag;away.ga+=hg;away.gd=away.gf-away.ga;
    if(ag>hg){away.won++;away.pts+=3;away.form.push('W');}
    else if(ag===hg){away.drawn++;away.pts+=1;away.form.push('D');}
    else{away.lost++;away.form.push('L');}
    if(away.form.length>5)away.form.shift();
  }
  // Also simulate other matches on matchdays
  const otherTeams=G.league.teams.filter(t=>!t.isPlayer&&t.name!==oppName);
  for(let i=0;i<otherTeams.length-1;i+=2){
    const a=otherTeams[i],b=otherTeams[i+1];
    if(!a||!b)continue;
    const r=E.simulateAIMatch(a,b);
    [a,b].forEach((t,idx)=>{
      const tg=idx===0?r.hg:r.ag;const og=idx===0?r.ag:r.hg;
      t.played++;t.gf+=tg;t.ga+=og;t.gd=t.gf-t.ga;
      if(tg>og){t.won++;t.pts+=3;t.form.push('W');}
      else if(tg===og){t.drawn++;t.pts+=1;t.form.push('D');}
      else{t.lost++;t.form.push('L');}
      if(t.form.length>5)t.form.shift();
    });
  }
}

function simulateTraining(){
  const opts=[
    {icon:'üèãÔ∏è',title:'Gym Session',detail:'Heavy weights and conditioning work.'},
    {icon:'üéØ',title:'Finishing Drills',detail:'Clinical work in front of goal.'},
    {icon:'üèÉ',title:'Sprint Training',detail:'Explosive pace work on the training ground.'},
    {icon:'üß†',title:'Tactical Session',detail:'Video analysis and positional work.'},
    {icon:'ü§∏',title:'Recovery & Stretch',detail:'Pool session and light stretching.'},
    {icon:'üéΩ',title:'Team Practice',detail:'Full squad session ‚Äî building chemistry.'},
    {icon:'üßò',title:'Rest Day',detail:'Active rest and mental preparation.'},
  ];
  return{type:'training',...E.pick(opts)};
}

function simulateOffseasonTraining(){
  const opts=[
    {icon:'‚òÄÔ∏è',title:'Pre-Season Training',detail:'Building fitness for the new season.'},
    {icon:'üèãÔ∏è',title:'Strength & Conditioning',detail:'Intense gym work to prepare for the campaign.'},
    {icon:'üåç',title:'Pre-Season Tour',detail:'Training camp abroad ‚Äî bonding with new teammates.'},
    {icon:'üèÉ',title:'Fitness Testing',detail:'Club fitness tests ‚Äî looking sharp.'},
    {icon:'‚öΩ',title:'Pre-Season Friendly',detail:'Friendly match ‚Äî shaking off the rust.'},
  ];
  return{type:'training',...E.pick(opts)};
}

function simulateGrowth(){
  const keys=['pace','shooting','passing','dribbling','defending','physical'];
  const w=POS_WEIGHTS[G.player.position]||{};
  const sorted=keys.slice().sort((a,b)=>(w[b]||1)-(w[a]||1));
  const k=E.pick(sorted.slice(0,4));
  const cur=G.player.attrs[k];
  if(cur>=90)return null;
  const gain=E.rand(1,1);
  G.player.attrs[k]=E.clamp(cur+gain,0,90);
  G.player.overall=E.calcOVR(G.player.attrs,G.player.position);
  const labels={pace:'Pace',shooting:'Shooting',passing:'Passing',dribbling:'Dribbling',defending:'Defending',physical:'Physical'};
  return{type:'growth',icon:'üìà',title:`${labels[k]} +${gain}`,detail:`${labels[k]} now ${G.player.attrs[k]}`};
}

function checkMilestones(events,day){
  const st=G.seasonStats;const cs=G.careerStats;
  const check=(key,cond,icon,title,detail)=>{
    if(cond&&!G.achievements.has(key)){
      G.achievements.add(key);
      events.push({type:'milestone',icon,title,detail});
      G.careerLog.push({icon,title,detail,date:getDayLabel(day)});
      showToast(`${icon} ${title}`);
    }
  };
  check('g10s',st.goals>=10,'üéØ','10 Season Goals!','Double figures ‚Äî clinical performer.');
  check('g20s',st.goals>=20,'üî•','20-Goal Season!','Outstanding ‚Äî top scorer material.');
  check('g50c',cs.goals>=50,'‚≠ê','50 Career Goals!','Half a century ‚Äî a remarkable milestone.');
  check('g100c',cs.goals>=100,'üåü','100 Career Goals!','A true legend of the game.');
  check('m5s',st.motm>=5,'üèÖ','5 MOTMs This Season!','Consistently the best on the pitch.');
  check('app100',cs.apps>=100,'üëï','100 Career Appearances','A real professional ‚Äî 100 caps.');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SEASON END
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function endSeason(){
  G.season.finished=true;
  G.careerStats.seasons++;

  // End-of-season attribute growth
  const ageBoost=Math.max(0.2,1.4-(G.player.age-17)*.1);
  const keys=['pace','shooting','passing','dribbling','defending','physical'];
  const w=POS_WEIGHTS[G.player.position]||{};
  keys.slice().sort((a,b)=>(w[b]||1)-(w[a]||1)).slice(0,3).forEach(k=>{
    const gain=E.rand(0,Math.round(2*ageBoost));
    G.player.attrs[k]=E.clamp(G.player.attrs[k]+gain,0,90);
  });
  G.player.overall=E.calcOVR(G.player.attrs,G.player.position);
  G.careerStats.bestOVR=Math.max(G.careerStats.bestOVR,G.player.overall);

  const st=G.seasonStats;
  G.careerLog.push({icon:'üèÅ',title:`Season ${G.season.number} Complete`,
    detail:`${st.apps} apps ¬∑ ${st.goals}G ${st.assists}A ¬∑ Rating ${st.avgRating||'‚Äî'}`,
    date:'End of Season'});

  // Check promotion/relegation
  checkLeagueResult();

  // Contract check
  G.club.contractYears--;
  if(G.club.contractYears<=0){
    // Offer new contract or become free agent
    const myPos=getLeaguePosition();
    if(myPos>Math.floor(G.league.teams.length/2)&&G.player.overall<58){
      // Club releases player
      G.club.isFreeAgent=true;
      G.club.name='Free Agent';
      G.careerLog.push({icon:'üîì',title:'Released by club',detail:'The club chose not to renew your contract.',date:'End of Season'});
    } else {
      G.club.contractYears=E.rand(2,4);
      G.weeklySalary=Math.round(G.weeklySalary*E.rand(105,120)/100);
    }
  }

  G.player.age++;
  showSeasonEndModal();
}

function checkLeagueResult(){
  const sorted=getSortedTable();
  const myPos=sorted.findIndex(t=>t.isPlayer)+1;
  const league=LEAGUES.find(l=>l.tier===G.club.tier);
  if(!league)return;

  let moved=false;
  if(G.club.tier>1&&myPos<=league.promoted){
    G.club.tier--;
    const newLeague=LEAGUES.find(l=>l.tier===G.club.tier);
    if(newLeague){
      G.club.leagueId=newLeague.id;
      G.weeklySalary=Math.round(G.weeklySalary*1.25);
      G.careerLog.push({icon:'üöÄ',title:'Promoted!',detail:`Moving up to the ${newLeague.name}`,date:'End of Season'});
      G.careerStats.highestLeague=Math.min(G.careerStats.highestLeague,G.club.tier);
      moved=true;
    }
  } else if(league.relegated&&G.club.tier<5&&myPos>sorted.length-league.relegated){
    G.club.tier++;
    const newLeague=LEAGUES.find(l=>l.tier===G.club.tier);
    if(newLeague){
      G.club.leagueId=newLeague.id;
      G.weeklySalary=Math.round(G.weeklySalary*.85);
      G.careerLog.push({icon:'üìâ',title:'Relegated',detail:`Dropped to the ${newLeague.name}`,date:'End of Season'});
      moved=true;
    }
  }

  if(myPos===1){
    G.careerStats.trophies++;
    G.careerLog.push({icon:'üèÜ',title:`${G.league.name} Champions!`,detail:'Finished top of the league!',date:'End of Season'});
  }
}

function getLeaguePosition(){
  return getSortedTable().findIndex(t=>t.isPlayer)+1;
}

function getSortedTable(){
  return [...G.league.teams].sort((a,b)=>b.pts-a.pts||(b.gd-a.gd)||(b.gf-a.gf));
}

function startNewSeason(){
  closeModal();
  const prevClub=G.club.name;

  // Generate offers if free agent
  if(G.club.isFreeAgent){
    showFreeAgentOffers();
    return;
  }

  G.season={number:G.season.number+1,startYear:G.season.startYear+1,dayOfSeason:0,totalDays:365,finished:false,offSeason:false};
  G.seasonStats={goals:0,assists:0,apps:0,motm:0,yellows:0,reds:0,wins:0,draws:0,losses:0,ratingSum:0,ratingCount:0,avgRating:0,cleanSheets:0};
  G.dayLog=[];G.matchHistory=[];G.form=[];G.injuryDaysLeft=0;

  // Regenerate league
  const league=LEAGUES.find(l=>l.tier===G.club.tier)||LEAGUES[0];
  G.league={name:league.name,tier:G.club.tier,teams:E.generateLeague(G.club.tier,G.club.name),matchdays:[],nextMatchday:0};
  scheduleLeague();
  scheduleCups();

  G.careerLog.push({icon:'üîÑ',title:`Season ${G.season.number} Begins`,detail:`${G.club.name} ¬∑ ${league.name}`,date:'Pre-Season'});

  renderDashboard();
  showToast('üÜï New season started!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FREE AGENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generateFreeAgentOffers(){
  const offers=[];
  // Generate 3-5 offers from clubs at appropriate tier
  const numOffers=E.rand(3,5);
  for(let i=0;i<numOffers;i++){
    let tier=G.club.tier+E.rand(-1,1);
    tier=E.clamp(tier,1,5);
    const league=LEAGUES.find(l=>l.tier===tier)||LEAGUES[0];
    const clubName=E.pick(CLUBS[tier]);
    offers.push({tier,league:league.name,clubName,salary:Math.round(league.salary*(0.8+Math.random()*.4)),contractYears:E.rand(1,3)});
  }
  return offers;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SAVE / LOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveGame(){
  const save={...G,achievements:[...G.achievements]};
  try{
    localStorage.setItem('propath_save',JSON.stringify(save));
    showToast('üíæ Game saved!');
  }catch(e){showToast('‚ùå Save failed (storage full?)');}
}

function loadGame(){
  try{
    const raw=localStorage.getItem('propath_save');
    if(!raw){showToast('No save found.');return;}
    const save=JSON.parse(raw);
    save.achievements=new Set(save.achievements||[]);
    G=save;
    App.goTo(5);
    showToast('‚úÖ Career loaded!');
  }catch(e){showToast('‚ùå Load failed.');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HALL OF FAME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getHOF(){
  try{return JSON.parse(localStorage.getItem('propath_hof')||'[]');}catch{return[];}
}
function saveToHOF(){
  const hof=getHOF();
  hof.push({
    name:`${G.player.firstName} ${G.player.lastName}`,
    nation:G.player.nation,position:G.player.position,
    age:G.player.age,
    goals:G.careerStats.goals,assists:G.careerStats.assists,
    apps:G.careerStats.apps,trophies:G.careerStats.trophies,
    seasons:G.careerStats.seasons,bestOVR:G.careerStats.bestOVR,
    highestLeague:LEAGUES.find(l=>l.tier===G.careerStats.highestLeague)?.name||'‚Äî',
    date:new Date().getFullYear(),
  });
  localStorage.setItem('propath_hof',JSON.stringify(hof.slice(-20)));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TRAINING SHOP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buyTraining(statKey){
  const cur=G.player.attrs[statKey];
  const cost=E.trainCost(cur);
  if(G.wallet<cost){showToast('‚ùå Not enough money!');return;}
  if(cur>=90){showToast('Attribute maxed!');return;}
  G.wallet-=cost;
  G.player.attrs[statKey]=E.clamp(cur+1,0,90);
  G.player.overall=E.calcOVR(G.player.attrs,G.player.position);
  renderTrainingTab();
  renderAttrGrid();
  renderPlayerCard();
  showToast(`‚úÖ ${statKey} improved to ${G.player.attrs[statKey]}!`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ratingColor(v){if(v>=80)return'#00e5a0';if(v>=70)return'#f5c842';if(v>=60)return'#ff6b35';return'#ff4757';}
function statColor(v){return v>=75?'good':v>=60?'mid':'low';}
function formDot(r){const c=r>=72?'#00e5a0':r>=60?'#f5c842':'#ff4757';return`<span style="display:inline-block;width:9px;height:9px;border-radius:50%;background:${c};margin:0 2px;" title="${r}"></span>`;}
function fmt(n){return n>=1000?`¬£${(n/1000).toFixed(n>=10000?0:1)}k`:`¬£${n}`;}

function renderPlayerCard(){
  const p=G.player;const cl=G.club;
  const nat=NATIONS.find(n=>n.name===p.nation)||{flag:'üåç'};
  const trait=TRAITS[p.trait]||{};
  document.getElementById('dashPlayerCard').innerHTML=`
    <div class="player-card-preview">
      <div class="card-avatar">${nat.flag}</div>
      <div class="card-info">
        <div class="card-name">${p.firstName.toUpperCase()} ${p.lastName.toUpperCase()}</div>
        <div class="card-meta">
          <span class="meta-pill pos">${p.position}</span>
          <span class="meta-pill age">Age ${p.age}</span>
          <span class="meta-pill nat">${nat.flag} ${p.nation}</span>
          <span class="meta-pill" style="color:var(--accent2);border-color:rgba(255,107,53,.3);">${trait.icon||''} ${trait.name||''}</span>
          ${!cl.isFreeAgent?`<span class="meta-pill" style="color:var(--blue);border-color:rgba(74,158,255,.3);">üèüÔ∏è ${cl.name}</span>`:'<span class="meta-pill chip-red">üîì Free Agent</span>'}
        </div>
      </div>
      <div class="card-rating-box"><div class="rating-num">${p.overall}</div><div class="rating-label">OVR</div></div>
    </div>`;
}

function renderAttrGrid(){
  const a=G.player.attrs;
  document.getElementById('dashAttrs').innerHTML=['pace','shooting','passing','dribbling','defending','physical'].map((k,i)=>{
    const labels=['PAC','SHO','PAS','DRI','DEF','PHY'];
    return`<div class="attr-box"><div class="attr-v ${statColor(a[k])}">${a[k]}</div><div class="attr-l">${labels[i]}</div></div>`;
  }).join('');
}

function renderProgressBar(){
  const s=G.season;
  const pct=Math.round((s.dayOfSeason/s.totalDays)*100);
  document.getElementById('seasonProgress').innerHTML=`
    <div class="season-prog">
      <div class="prog-labels"><span>Season Progress</span><span>${getDayLabel(s.dayOfSeason)} ¬∑ ${pct}%</span></div>
      <div class="prog-track"><div class="prog-fill" style="width:${pct}%"></div></div>
    </div>`;
}

function renderStatPills(){
  const st=G.seasonStats;
  const items=[
    {icon:'‚öΩ',label:'Goals',val:st.goals},{icon:'üéØ',label:'Assists',val:st.assists},
    {icon:'üëï',label:'Apps',val:st.apps},{icon:'üåü',label:'MOTM',val:st.motm},
    {icon:'‚≠ê',label:'Avg Rat',val:st.avgRating||'‚Äî'},{icon:'üü®',label:'Yellows',val:st.yellows},
  ];
  document.getElementById('seasonStatPills').innerHTML=items.map(({icon,label,val})=>
    `<div class="stat-pill"><span class="sp-icon">${icon}</span><span class="sp-val">${val}</span><span class="sp-label">${label}</span></div>`
  ).join('');
}

function renderLeagueTable(){
  const sorted=getSortedTable();
  const league=LEAGUES.find(l=>l.tier===G.club.tier)||LEAGUES[0];
  document.getElementById('leagueName').textContent=G.league.name;

  const qualInfo=[];
  if(league.promoted>0)qualInfo.push(`Top ${league.promoted}: Promoted`);
  if(G.club.tier===1)qualInfo.push('Top 4: Europa Elite');
  if(league.relegated)qualInfo.push(`Bottom ${league.relegated}: Relegated`);
  document.getElementById('leagueQualInfo').textContent=qualInfo.join(' ¬∑ ');

  const tbody=sorted.map((t,i)=>{
    const pos=i+1;
    const posCls=pos<=league.promoted?'top':pos>sorted.length-league.relegated?'rel':'mid';
    const formDots=(t.form||[]).slice(-5).map(r=>{
      const c=r==='W'?'#00e5a0':r==='D'?'#f5c842':'#ff4757';
      return`<div class="form-dot" style="background:${c}" title="${r}"></div>`;
    }).join('');
    return`<tr class="${t.isPlayer?'my-team':''}">
      <td class="pos-col ${posCls}">${pos}</td>
      <td class="team-col" style="min-width:140px;font-size:12px;font-weight:${t.isPlayer?700:400};">${t.name}${t.isPlayer?' ‚≠ê':''}</td>
      <td>${t.played}</td><td>${t.won}</td><td>${t.drawn}</td><td>${t.lost}</td>
      <td>${t.gf}</td><td>${t.ga}</td><td>${t.gd>0?'+':''}${t.gd}</td>
      <td style="font-weight:700;color:var(--text);">${t.pts}</td>
      <td><div class="form-dots">${formDots}</div></td>
    </tr>`;
  }).join('');

  const el=document.getElementById('leagueTable');
  el.querySelector('thead').innerHTML=`<tr><th>#</th><th>Club</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th><th>Form</th></tr>`;
  el.querySelector('tbody').innerHTML=tbody;
}

function renderCupsTab(){
  const el=document.getElementById('cupsList');
  const all=CUPS.filter(c=>G.cups&&G.cups[c.id]);
  if(all.length===0){el.innerHTML='<div class="empty-state">‚öΩ<br><br>No cup competitions this season</div>';return;}
  el.innerHTML=all.map(cup_def=>{
    const c=G.cups[cup_def.id];
    let statusText='In progress',resultColor='var(--text-dim)';
    if(c.winner){statusText='üèÜ Winner!';resultColor='var(--gold)';}
    else if(c.eliminated){statusText=`Eliminated (${cup_def.rounds[c.stage-1]||'early round'})`;resultColor='var(--red)';}
    else{const nextRound=cup_def.rounds[c.stage]||'Final';statusText=`Next: ${nextRound}`;}
    return`<div class="comp-row">
      <div class="comp-badge" style="background:rgba(245,200,66,.1);">${cup_def.icon}</div>
      <div class="comp-info"><div class="comp-name">${cup_def.name}</div><div class="comp-status">${cup_def.desc}</div></div>
      <div class="comp-result" style="color:${resultColor}">${statusText}</div>
    </div>`;
  }).join('');
}

function renderTrainingTab(){
  const keys=['pace','shooting','passing','dribbling','defending','physical'];
  const labels={pace:'Pace',shooting:'Shooting',passing:'Passing',dribbling:'Dribbling',defending:'Defending',physical:'Physical'};
  const colors={pace:'#00e5a0',shooting:'#ff6b35',passing:'#4a9eff',dribbling:'#f5c842',defending:'#a78bfa',physical:'#fb7185'};
  document.getElementById('walletAmount').textContent=`¬£${G.wallet.toLocaleString()}`;
  document.getElementById('weeklySalaryLabel').textContent=`Weekly wages: ¬£${G.weeklySalary.toLocaleString()}`;
  document.getElementById('trainingGrid').innerHTML=keys.map(k=>{
    const cur=G.player.attrs[k];
    const cost=E.trainCost(cur);
    const canAfford=G.wallet>=cost;
    const maxed=cur>=90;
    return`<div class="train-item">
      <div class="train-stat-name" style="color:${colors[k]}">${labels[k]}</div>
      <div class="train-current" style="color:${colors[k]}">${cur}</div>
      <div class="train-cost ${canAfford?'':'cant-afford'}">${maxed?'Maxed out':`Next +1: ¬£${cost.toLocaleString()}`}</div>
      <button class="btn ${canAfford&&!maxed?'btn-primary':'btn-ghost'}" style="width:100%;padding:9px;" ${!canAfford||maxed?'disabled':''} onclick="buyTraining('${k}')">
        ${maxed?'Max':'Improve +1'}
      </button>
    </div>`;
  }).join('');
}

function renderCareerTab(){
  const cs=G.careerStats;
  document.getElementById('careerStatsGrid').innerHTML=[
    {l:'Career Goals',v:cs.goals,c:'var(--accent)'},{l:'Career Assists',v:cs.assists,c:'var(--blue)'},
    {l:'Appearances',v:cs.apps,c:'var(--text)'},{l:'MOTM Awards',v:cs.motm,c:'var(--gold)'},
    {l:'Seasons Played',v:cs.seasons,c:'var(--text)'},{l:'Trophies',v:cs.trophies,c:'var(--gold)'},
    {l:'Best OVR',v:cs.bestOVR,c:'var(--accent2)'},{l:'Red Cards',v:cs.reds,c:'var(--red)'},
  ].map(({l,v,c})=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border);">
    <span style="font-size:12px;color:var(--text-dim);">${l}</span>
    <span style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:${c};">${v}</span>
  </div>`).join('');

  document.getElementById('contractInfo').innerHTML=`
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div><div class="s-label">Club</div><div style="font-size:16px;font-weight:600;">${G.club.isFreeAgent?'Free Agent üîì':G.club.name}</div></div>
      <div><div class="s-label">League</div><div style="font-size:14px;">${LEAGUES.find(l=>l.tier===G.club.tier)?.name||'‚Äî'}</div></div>
      <div><div class="s-label">Contract</div><div style="font-size:14px;">${G.club.isFreeAgent?'None':G.club.contractYears+' year'+(G.club.contractYears!==1?'s':'')}</div></div>
      <div><div class="s-label">Weekly Wage</div><div style="font-size:16px;font-weight:600;color:var(--gold);">¬£${G.weeklySalary.toLocaleString()}</div></div>
      <div><div class="s-label">Balance</div><div style="font-size:16px;font-weight:600;color:var(--gold);">¬£${G.wallet.toLocaleString()}</div></div>
    </div>`;

  const achList=[...G.achievements];
  document.getElementById('achievementsList').innerHTML=achList.length?
    `<div style="display:flex;flex-wrap:wrap;gap:8px;">${achList.map(a=>`<span class="chip chip-gold">üèÖ ${a}</span>`).join('')}</div>`:
    `<div class="empty-state">No achievements yet ‚Äî keep playing!</div>`;
}

function renderMatchesTab(){
  // Upcoming fixtures
  const today=G.season.dayOfSeason;
  const upcoming=G.league.matchdays.filter(d=>d>today).slice(0,5);
  document.getElementById('upcomingFixtures').innerHTML=upcoming.length?
    upcoming.map(d=>`<div class="log-row"><span class="lr-date">${getDayLabel(d)}</span><span class="lr-desc">League Matchday ¬∑ ${G.club.name}</span><span class="chip chip-blue">Upcoming</span></div>`).join(''):
    '<div class="empty-state">No upcoming fixtures scheduled</div>';

  // Match history
  document.getElementById('matchHistory').innerHTML=G.matchHistory.length?
    [...G.matchHistory].reverse().slice(0,20).map(m=>{
      const rc=m.result==='W'?'var(--accent)':m.result==='D'?'var(--gold)':'var(--red)';
      return`<div class="log-row">
        <span class="lr-date">${m.date}</span>
        <span class="lr-desc" style="flex:1;">${m.home} ${m.hg}‚Äì${m.ag} ${m.away}${m.isCup?' üèÜ':''}</span>
        <span style="font-weight:700;color:${rc};margin:0 8px;">${m.result}</span>
        ${m.goals?`<span class="chip chip-green">‚öΩ${m.goals}</span>`:''}
        ${m.motm?`<span class="chip chip-gold">‚≠ê</span>`:''}
        <span style="font-size:11px;font-weight:700;color:${ratingColor(m.rating)};margin-left:6px;">${m.rating}</span>
      </div>`;
    }).join(''):
    '<div class="empty-state">No matches played yet</div>';
}

function renderCareerLog(){
  document.getElementById('careerLog').innerHTML=[...G.careerLog].reverse().slice(0,20).map(e=>
    `<li class="timeline-event"><div class="te-icon">${e.icon}</div><div class="te-content"><div class="te-title">${e.title}</div><div class="te-meta">${e.detail}${e.date?` ¬∑ ${e.date}`:''}</div></div></li>`
  ).join('');
}

function renderRecentLog(){
  const el=document.getElementById('recentLog');
  const recent=[...G.dayLog].reverse().slice(0,40);
  if(!recent.length){el.innerHTML='<div style="font-size:12px;color:var(--text-muted);padding:8px;">No activity yet.</div>';return;}
  el.innerHTML=recent.map(entry=>{
    const ev=entry.events[0];
    const isMatch=entry.events.some(e=>e.type==='match'&&e.result);
    const matchEv=entry.events.find(e=>e.type==='match'&&e.result);
    let rc='',badge='';
    if(matchEv){const c=matchEv.result==='W'?'var(--accent)':matchEv.result==='D'?'var(--gold)':'var(--red)';badge=`<span style="font-weight:700;color:${c};">${matchEv.result}</span>`;}
    return`<div class="log-row"><span class="lr-date">${entry.date}</span><span class="lr-desc">${ev?.title||'Day passed'}</span>${badge}</div>`;
  }).join('');
}

function renderDashboard(){
  const p=G.player;const s=G.season;const cl=G.club;
  document.getElementById('dashGreeting').textContent=`Season ${s.number} ¬∑ ${p.nickname||p.firstName} ${p.lastName}`;
  document.getElementById('dashSubtitle').textContent=`${NATIONS.find(n=>n.name===p.nation)?.flag||''} ${p.nation} ¬∑ ${p.position} ¬∑ Age ${p.age}`;
  document.getElementById('seasonBadge').textContent=`${s.startYear}/${String(s.startYear+1).slice(2)}`;
  document.getElementById('salaryChip').textContent=`üí∞ ¬£${G.wallet.toLocaleString()}`;
  document.getElementById('currentDayLabel').textContent=getDayLabel(s.dayOfSeason);
  document.getElementById('formDots').innerHTML=G.form.map(formDot).join('')||'<span style="color:var(--text-muted);font-size:11px;">‚Äî</span>';
  document.getElementById('potDisplay').textContent=p.potential+' OVR';
  document.getElementById('freeAgentBanner').style.display=cl.isFreeAgent?'block':'none';

  const advBtn=document.getElementById('advanceBtn');
  const skipW=document.getElementById('skipWeekBtn');
  const skipM=document.getElementById('skipMonthBtn');
  if(s.finished){
    if(advBtn){advBtn.textContent='Season Over';advBtn.disabled=true;}
    if(skipW)skipW.disabled=true;if(skipM)skipM.disabled=true;
  } else {
    if(advBtn){advBtn.textContent='‚ñ∂ Next Day';advBtn.disabled=false;}
    if(skipW)skipW.disabled=false;if(skipM)skipM.disabled=false;
  }

  renderPlayerCard();
  renderAttrGrid();
  renderProgressBar();
  renderStatPills();
  renderCareerLog();
  renderRecentLog();
  // Update active tab
  const activeTab=document.querySelector('.tab-pane.active')?.id?.replace('tab-','');
  if(activeTab)refreshTab(activeTab);
}

function refreshTab(tab){
  if(tab==='league')renderLeagueTable();
  if(tab==='cups')renderCupsTab();
  if(tab==='training')renderTrainingTab();
  if(tab==='career')renderCareerTab();
  if(tab==='matches')renderMatchesTab();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showModal(html){
  document.getElementById('modalLayer').style.display='flex';
  document.getElementById('modalLayer').innerHTML=`<div class="modal-backdrop" onclick="closeModal()" style=""><div class="modal-box" onclick="event.stopPropagation()">${html}</div></div>`;
}
function closeModal(){
  document.getElementById('modalLayer').style.display='none';
  document.getElementById('modalLayer').innerHTML='';
}

function showSeasonEndModal(){
  const st=G.seasonStats;const p=G.player;
  const league=LEAGUES.find(l=>l.tier===G.club.tier)||LEAGUES[0];
  const pos=getLeaguePosition();
  const promoted=league.promoted&&pos<=league.promoted;
  const relegated=league.relegated&&pos>G.league.teams.length-league.relegated;
  const champions=pos===1;

  showModal(`
    <div class="modal-title">üèÅ Season ${G.season.number} Over!</div>
    <p style="color:var(--text-dim);font-size:13px;margin-bottom:14px;">
      ${p.firstName} ${p.lastName} ¬∑ ${G.club.name} ¬∑ Finished <strong>${pos}${pos===1?'st':pos===2?'nd':pos===3?'rd':'th'}</strong> in the ${G.league.name}
      ${champions?'üèÜ <strong style="color:var(--gold)">Champions!</strong>':''}
      ${promoted&&!champions?'üöÄ <strong style="color:var(--accent)">Promoted!</strong>':''}
      ${relegated?'üìâ <strong style="color:var(--red)">Relegated</strong>':''}
    </p>
    <div class="modal-stat-grid">
      <div class="modal-stat"><div class="ms-label">Goals</div><div class="ms-val" style="color:var(--accent)">${st.goals}</div></div>
      <div class="modal-stat"><div class="ms-label">Assists</div><div class="ms-val" style="color:var(--blue)">${st.assists}</div></div>
      <div class="modal-stat"><div class="ms-label">Appearances</div><div class="ms-val">${st.apps}</div></div>
      <div class="modal-stat"><div class="ms-label">Avg Rating</div><div class="ms-val" style="color:var(--gold)">${st.avgRating||'‚Äî'}</div></div>
      <div class="modal-stat"><div class="ms-label">MOTM</div><div class="ms-val" style="color:var(--gold)">${st.motm}</div></div>
      <div class="modal-stat"><div class="ms-label">New OVR</div><div class="ms-val" style="color:var(--accent2)">${p.overall}</div></div>
      <div class="modal-stat"><div class="ms-label">Trophies</div><div class="ms-val" style="color:var(--gold)">${G.careerStats.trophies}</div></div>
      <div class="modal-stat"><div class="ms-label">League Position</div><div class="ms-val">${pos}</div></div>
    </div>
    <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;">
      <button class="btn btn-primary" style="flex:1;" onclick="startNewSeason()">‚û° Next Season</button>
      <button class="btn btn-ghost" onclick="saveToHOF();closeModal();App.confirmNewCareer();" style="flex:1;">üèÜ Retire to Hall of Fame</button>
    </div>`);
}

function showFreeAgentOffers(){
  const offers=generateFreeAgentOffers();
  G.freeAgentOffers=offers;
  showModal(`
    <div class="modal-title">üîì Club Offers</div>
    <p style="color:var(--text-dim);font-size:13px;margin-bottom:16px;">You're a free agent. These clubs want to sign you ‚Äî no transfer window needed.</p>
    <div class="club-offers">
      ${offers.map((o,i)=>`
        <div class="club-offer">
          <div class="offer-info">
            <div class="offer-club">üèüÔ∏è ${o.clubName}</div>
            <div class="offer-detail">${o.league} ¬∑ ${o.contractYears}yr contract ¬∑ ¬£${o.salary.toLocaleString()}/wk</div>
          </div>
          <button class="btn btn-primary" style="padding:9px 16px;font-size:12px;" onclick="signFreeAgent(${i})">Sign</button>
        </div>`).join('')}
    </div>
    <button class="btn btn-ghost" style="width:100%;margin-top:12px;" onclick="closeModal()">Keep Waiting</button>`);
}

function signFreeAgent(idx){
  const o=G.freeAgentOffers[idx];
  G.club={name:o.clubName,tier:o.tier,leagueId:LEAGUES.find(l=>l.tier===o.tier)?.id||'L4',contractYears:o.contractYears,isFreeAgent:false};
  G.weeklySalary=o.salary;
  G.careerLog.push({icon:'‚úçÔ∏è',title:`Signed for ${o.clubName}`,detail:`${o.league} ¬∑ ¬£${o.salary.toLocaleString()}/wk`,date:getDayLabel(G.season.dayOfSeason)});
  closeModal();
  startNewSeason();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CHARACTER CREATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let draft={firstName:'',lastName:'',nickname:'',age:17,nation:null,position:null,foot:'Right',trait:null};
let creationStep=1;
let filteredNations=[...NATIONS];

function renderCreationStep(){
  const el=document.getElementById('creation-content');
  renderStepsBar();
  if(creationStep===1) el.innerHTML=stepIdentityHTML();
  if(creationStep===2) el.innerHTML=stepNationalityHTML();
  if(creationStep===3) el.innerHTML=stepPositionHTML();
  if(creationStep===4) el.innerHTML=stepReviewHTML();
}

function renderStepsBar(){
  const labels=['Identity','Nationality','Position','Review'];
  document.getElementById('steps-bar').innerHTML=labels.map((l,i)=>{
    const n=i+1;const cls=n<creationStep?'step done':n===creationStep?'step active':'step';
    return`<div class="${cls}"><div class="step-dot">${n<creationStep?'‚úì':n}</div><span>${l}</span></div>${i<3?'<div class="step-line"></div>':''}`;
  }).join('');
}

function stepIdentityHTML(){
  return`
    <div class="section-label">Step 1 of 4</div><h2>Who Are You?</h2>
    <p class="lead">Your name and starting age ‚Äî the first page of your story.</p>
    <div class="form-grid">
      <div class="form-group"><label>First Name</label><input type="text" id="f-firstName" value="${draft.firstName}" placeholder="Marcus" maxlength="20"><span class="field-error" id="err-first">Enter your first name</span></div>
      <div class="form-group"><label>Last Name</label><input type="text" id="f-lastName" value="${draft.lastName}" placeholder="Silva" maxlength="24"><span class="field-error" id="err-last">Enter your last name</span></div>
      <div class="form-group full"><label>Nickname <span style="font-size:10px;color:var(--text-muted);text-transform:none;letter-spacing:0;">(optional)</span></label><input type="text" id="f-nickname" value="${draft.nickname}" placeholder="The Flash" maxlength="20"></div>
      <div class="form-group full">
        <label>Starting Age</label>
        <div class="age-slider-wrap">
          <div class="age-display" id="ageDisplay">${draft.age}</div>
          <div class="age-info">
            <input type="range" id="ageSlider" min="15" max="30" value="${draft.age}" oninput="updateAge(this.value)">
            <div class="range-labels"><span>15 ‚Äî Youth Academy</span><span>30 ‚Äî Veteran</span></div>
            <p class="age-desc-text" id="ageDesc">${AGE_DESC[draft.age]||''}</p>
          </div>
        </div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="App.goTo(0)">‚Üê Back</button>
      <button class="btn btn-primary" onclick="step1Next()">Continue ‚Üí</button>
    </div>`;
}

function stepNationalityHTML(){
  return`
    <div class="section-label">Step 2 of 4</div><h2>Nationality</h2>
    <p class="lead">Where does your footballer come from?</p>
    <div style="margin-bottom:10px;"><input type="text" id="nationSearch" placeholder="üîç Search country‚Ä¶" oninput="filterNations(this.value)" value=""></div>
    <div class="nations-grid" id="nationsGrid"></div>
    <span class="field-error" id="err-nation" style="margin-top:6px;">Please select a nationality</span>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="creationStep=1;renderCreationStep()">‚Üê Back</button>
      <button class="btn btn-primary" onclick="step2Next()">Continue ‚Üí</button>
    </div>`;
}

function stepPositionHTML(){
  return`
    <div class="section-label">Step 3 of 4</div><h2>Position & Style</h2>
    <p class="lead">Your role on the pitch and the archetype that defines your game.</p>
    <div class="field-label">Position</div>
    <div class="position-grid">${POSITIONS.map(p=>`<div class="pos-btn ${draft.position===p.acronym?'selected':''}" onclick="selectPos('${p.acronym}')"><span class="pos-acronym">${p.acronym}</span><span class="pos-name">${p.name}</span></div>`).join('')}</div>
    <span class="field-error" id="err-pos">Please select a position</span>
    <div class="field-label" style="margin-top:18px;">Preferred Foot</div>
    <div style="display:flex;gap:8px;margin-bottom:16px;">
      ${['Right','Left','Both'].map(f=>`<div class="pos-btn ${draft.foot===f?'selected':''}" onclick="selectFoot('${f}')" style="min-width:90px;"><span class="pos-acronym">${f[0]}</span><span class="pos-name">${f} Foot</span></div>`).join('')}
    </div>
    <div class="field-label">Playing Style</div>
    <div class="trait-grid">${TRAITS.map((t,i)=>`<div class="trait-card ${draft.trait===i?'selected':''}" onclick="selectTrait(${i})"><span class="trait-icon">${t.icon}</span><div class="trait-name">${t.name}</div><div class="trait-desc">${t.desc}</div></div>`).join('')}</div>
    <span class="field-error" id="err-trait">Pick a playing style</span>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="creationStep=2;renderCreationStep()">‚Üê Back</button>
      <button class="btn btn-primary" onclick="step3Next()">Continue ‚Üí</button>
    </div>`;
}

function stepReviewHTML(){
  const attrs=E.buildAttrs(draft.position,draft.age,draft.trait);
  const ovr=E.calcOVR(attrs,draft.position);
  const pot=E.calcPotential(ovr,draft.age);
  draft.attrs=attrs;draft.overall=ovr;draft.potential=pot;
  const nat=NATIONS.find(n=>n.name===draft.nation)||{flag:'üåç'};
  const pos=POSITIONS.find(p=>p.acronym===draft.position)||{};
  const trait=TRAITS[draft.trait]||{};
  const club=assignClub(draft.age,ovr);
  const statKeys=['pace','shooting','passing','dribbling','defending','physical'];
  const statColors=['#00e5a0','#ff6b35','#4a9eff','#f5c842','#a78bfa','#fb7185'];
  const statNames=['PACE','SHOOTING','PASSING','DRIBBLING','DEFENDING','PHYSICAL'];
  return`
    <div class="section-label">Step 4 of 4 ‚Äî Review</div><h2>Ready, Player One?</h2>
    <p class="lead">Confirm and kick off your career.</p>
    <div class="player-card-preview">
      <div class="card-avatar">${nat.flag}</div>
      <div class="card-info">
        <div class="card-name">${draft.firstName.toUpperCase()} ${draft.lastName.toUpperCase()}</div>
        <div class="card-meta">
          <span class="meta-pill pos">${draft.position}</span>
          <span class="meta-pill age">Age ${draft.age}</span>
          <span class="meta-pill nat">${nat.flag} ${draft.nation}</span>
        </div>
      </div>
      <div class="card-rating-box"><div class="rating-num">${ovr}</div><div class="rating-label">OVR</div></div>
    </div>
    <div class="summary-grid">
      ${[['Full Name',`${draft.firstName} ${draft.lastName}`],['Nationality',`${nat.flag} ${draft.nation}`],['Position',`${draft.position} ¬∑ ${pos.name||''}`],['Playing Style',`${trait.icon||''} ${trait.name||''}`],['Starting Age',`${draft.age} yrs`],['Potential',`${pot} OVR`],['Starting Club',club.clubName],['League',club.name]].map(([l,v])=>`<div class="summary-item"><div class="s-label">${l}</div><div class="s-value">${v}</div></div>`).join('')}
    </div>
    <div class="field-label">Starting Attributes</div>
    <div class="stat-bars">${statKeys.map((k,i)=>`<div class="stat-row"><span class="stat-name">${statNames[i]}</span><div class="stat-bar-track"><div class="stat-bar-fill" style="width:${attrs[k]}%;background:${statColors[i]};"></div></div><span class="stat-val" style="color:${statColors[i]};">${attrs[k]}</span></div>`).join('')}</div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="creationStep=3;renderCreationStep()">‚Üê Edit</button>
      <button class="btn btn-primary" style="font-size:15px;" onclick="beginCareer()">‚öΩ Begin Career</button>
    </div>`;
}

// Creation helpers
function updateAge(v){draft.age=parseInt(v);document.getElementById('ageDisplay').textContent=v;document.getElementById('ageDesc').textContent=AGE_DESC[v]||'';}
function filterNations(q){filteredNations=NATIONS.filter(n=>n.name.toLowerCase().includes(q.toLowerCase()));renderNationsGrid();}
function renderNationsGrid(){
  const el=document.getElementById('nationsGrid');if(!el)return;
  el.innerHTML=filteredNations.map(n=>`<div class="nation-btn ${draft.nation===n.name?'selected':''}" onclick="selectNation('${n.name.replace(/'/g,"\\'")}')"><span class="nation-flag">${n.flag}</span><span>${n.name}</span></div>`).join('');
}
function selectNation(name){draft.nation=name;renderNationsGrid();}
function selectPos(ac){draft.position=ac;document.querySelectorAll('.pos-btn').forEach(b=>b.classList.toggle('selected',b.textContent.trim().startsWith(ac)));}
function selectFoot(f){draft.foot=f;document.querySelectorAll('.pos-btn').forEach(b=>{if(['R','L','B'].some(x=>b.querySelector('.pos-acronym')?.textContent===x))b.classList.toggle('selected',b.querySelector('.pos-acronym')?.textContent===f[0]);});}
function selectTrait(i){draft.trait=i;document.querySelectorAll('.trait-card').forEach((c,idx)=>c.classList.toggle('selected',idx===i));}

function step1Next(){
  draft.firstName=document.getElementById('f-firstName')?.value.trim()||'';
  draft.lastName=document.getElementById('f-lastName')?.value.trim()||'';
  draft.nickname=document.getElementById('f-nickname')?.value.trim()||'';
  let ok=true;
  if(!draft.firstName){document.getElementById('err-first').classList.add('show');ok=false;}else document.getElementById('err-first').classList.remove('show');
  if(!draft.lastName){document.getElementById('err-last').classList.add('show');ok=false;}else document.getElementById('err-last').classList.remove('show');
  if(ok){creationStep=2;renderCreationStep();setTimeout(()=>{renderNationsGrid();},0);}
}
function step2Next(){
  if(!draft.nation){document.getElementById('err-nation').classList.add('show');return;}
  creationStep=3;renderCreationStep();
}
function step3Next(){
  let ok=true;
  if(!draft.position){document.getElementById('err-pos').classList.add('show');ok=false;}else document.getElementById('err-pos').classList.remove('show');
  if(draft.trait===null){document.getElementById('err-trait').classList.add('show');ok=false;}else document.getElementById('err-trait').classList.remove('show');
  if(ok){creationStep=4;renderCreationStep();}
}
function beginCareer(){initGame(draft);App.goTo(5);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HALL OF FAME RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHOF(){
  const hof=getHOF();
  const el=document.getElementById('hofContent');
  if(!hof.length){
    el.innerHTML=`<div class="hof-empty"><div class="hof-trophy">üèÜ</div><div style="font-size:18px;font-weight:600;margin-bottom:8px;">No Legends Yet</div><div style="color:var(--text-dim);">Complete a career and retire to add your first legend.</div></div>`;
    return;
  }
  el.innerHTML=`<div class="hof-grid">${hof.reverse().map(p=>`
    <div class="hof-card">
      <div class="hof-name">${p.name}</div>
      <div class="hof-meta">${NATIONS.find(n=>n.name===p.nation)?.flag||''} ${p.nation} ¬∑ ${p.position} ¬∑ ${p.seasons} seasons ¬∑ Class of ${p.date}</div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:10px;">Peak: ${p.bestOVR} OVR ¬∑ ${p.highestLeague}</div>
      <div class="hof-stats">
        <div class="hof-stat"><div class="hof-stat-v" style="color:var(--accent)">${p.goals}</div><div class="hof-stat-l">Goals</div></div>
        <div class="hof-stat"><div class="hof-stat-v" style="color:var(--blue)">${p.assists}</div><div class="hof-stat-l">Assists</div></div>
        <div class="hof-stat"><div class="hof-stat-v">${p.apps}</div><div class="hof-stat-l">Apps</div></div>
        <div class="hof-stat"><div class="hof-stat-v" style="color:var(--gold)">${p.trophies}</div><div class="hof-stat-l">Trophies</div></div>
      </div>
    </div>`).join('')}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  APP CONTROLLER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const App={
  goTo(n){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('screen-'+n)?.classList.add('active');
    if(n===1){creationStep=1;draft={firstName:'',lastName:'',nickname:'',age:17,nation:null,position:null,foot:'Right',trait:null};renderCreationStep();}
    if(n===5)renderDashboard();
    if(n===6)renderHOF();
    window.scrollTo({top:0,behavior:'smooth'});
  },

  advanceDay(){
    if(!G.season||G.season.finished)return;
    const events=simulateDay();
    G.dayLog.push({date:getDayLabel(G.season.dayOfSeason),events});
    const evEl=document.getElementById('lastDayEvents');
    if(evEl)evEl.innerHTML=events.map(renderDayEvent).join('');
    G.season.dayOfSeason++;
    if(G.season.dayOfSeason>=G.season.totalDays)endSeason();
    else renderDashboard();
  },

  skipWeek(){
    if(!G.season||G.season.finished)return;
    for(let i=0;i<7;i++){
      if(G.season.finished||G.season.dayOfSeason>=G.season.totalDays)break;
      const events=simulateDay();
      G.dayLog.push({date:getDayLabel(G.season.dayOfSeason),events});
      G.season.dayOfSeason++;
    }
    if(G.season.dayOfSeason>=G.season.totalDays)endSeason();
    else{renderDashboard();const last=G.dayLog[G.dayLog.length-1];const evEl=document.getElementById('lastDayEvents');if(evEl&&last)evEl.innerHTML=last.events.map(renderDayEvent).join('');}
    showToast('‚è© Week skipped');
  },

  skipMonth(){
    if(!G.season||G.season.finished)return;
    for(let i=0;i<30;i++){
      if(G.season.finished||G.season.dayOfSeason>=G.season.totalDays)break;
      const events=simulateDay();
      G.dayLog.push({date:getDayLabel(G.season.dayOfSeason),events});
      G.season.dayOfSeason++;
    }
    if(G.season.dayOfSeason>=G.season.totalDays)endSeason();
    else{renderDashboard();const last=G.dayLog[G.dayLog.length-1];const evEl=document.getElementById('lastDayEvents');if(evEl&&last)evEl.innerHTML=last.events.map(renderDayEvent).join('');}
    showToast('‚è≠ Month skipped');
  },

  switchTab(tab){
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('tab-'+tab)?.classList.add('active');
    refreshTab(tab);
  },

  saveGame(){saveGame();},
  loadGame(){loadGame();},

  confirmNewCareer(){
    showModal(`<div class="modal-title">New Career?</div><p style="color:var(--text-dim);font-size:13px;margin-bottom:20px;">This will end your current career. Consider retiring to the Hall of Fame first.</p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button class="btn btn-danger" style="flex:1;" onclick="saveToHOF();closeModal();App.goTo(0);">üèÜ Retire & New Career</button>
      <button class="btn btn-ghost" style="flex:1;" onclick="closeModal()">Cancel</button>
    </div>`);
  },

  showFreeAgentOffers(){showFreeAgentOffers();},
};

function renderDayEvent(ev){
  let tags='';
  if(ev.type==='match'){
    const rc=ev.result==='W'?'#00e5a0':ev.result==='D'?'#f5c842':'#ff4757';
    if(ev.result)tags+=`<span class="tag tag-result" style="color:${rc};border-color:${rc}40;">${ev.result} ${ev.hg||0}‚Äì${ev.ag||0}</span>`;
    if(ev.myGoals>0)tags+=`<span class="tag tag-goal">‚öΩ${ev.myGoals}</span>`;
    if(ev.myAssists>0)tags+=`<span class="tag tag-goal">üéØ${ev.myAssists}</span>`;
    if(ev.motm)tags+=`<span class="tag tag-motm">üåü MOTM</span>`;
    if(ev.red)tags+=`<span class="tag tag-red">üü•</span>`;
    if(ev.myRating)tags+=`<span class="tag tag-rat" style="color:${ratingColor(ev.myRating)};">${ev.myRating}</span>`;
  }
  if(ev.type==='growth')tags+=`<span class="tag tag-goal">${ev.title}</span>`;
  if(ev.type==='milestone')tags+=`<span class="tag tag-motm">üèÜ Milestone</span>`;
  return`<div class="day-ev type-${ev.type}"><span class="dv-icon">${ev.icon||'üìã'}</span><div class="dv-body"><div class="dv-title">${ev.title}</div><div class="dv-detail">${ev.detail||''}</div><div class="dv-tags">${tags}</div></div></div>`;
}

function showToast(msg,ms=2800){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),ms);
}
</script>
</body>
</html>
